---
变量更新规则:
  # ============================================
  # 【强制规则】状态一致性约束
  # ============================================
  状态一致性规则: |-
    【强制规则】描绘场景前，必须先检查当前状态变量！

    ## ⚠️ 描写前强制检查清单

    在描绘任何场景、环境或角色行为前，必须先确认以下变量：

    1. **当前时间** (`世界.时间`) - 影响光线、氛围
    2. **当前天数** (`世界.当前天数`) - 影响剧情进度
    3. **游戏阶段** (`世界.游戏阶段`) - 日常/梦境/结局
    4. **苏文位置** (`现实数据.丈夫当前位置`) - 影响被发现风险
    5. **当前境界** (`赵霞状态.当前境界`) - 影响赵霞反应

    然后确保你的描述与这些状态完全一致！

    ## 📋 时间一致性约束表

    | 时间值 | 场景描述要求 | 禁止描写 |
    |--------|-------------|---------|
    | 06:00-08:00 | 清晨、晨光、朝阳初升 | 深夜、夜色、星空 |
    | 08:00-12:00 | 上午、阳光明媚 | 深夜、傍晚、月光 |
    | 12:00-14:00 | 正午、阳光直射、午休 | 晨曦、黄昏、夜幕 |
    | 14:00-18:00 | 下午、暖阳 | 清晨、深夜 |
    | 18:00-20:00 | 傍晚、夕阳西下、黄昏 | 清晨、正午、深夜 |
    | 20:00-22:00 | 晚间、灯光、夜幕初降 | 白天、阳光 |
    | 22:00-06:00 | 深夜、夜色、月光、静谧 | 白天、阳光、清晨 |

    ## 📋 苏文状态约束表

    | 苏文位置 | 允许的描写 | 禁止的描写 |
    |----------|-----------|-----------|
    | 客厅/餐厅/厨房 | 苏文在家中活动、可能随时出现 | 完全忽视苏文存在 |
    | 卧室（睡眠中） | 苏文在卧室睡觉、安静 | 苏文活动、说话、走动 |
    | 书房 | 苏文在书房工作、可能被打扰 | 苏文在其他位置 |
    | 外出 | 苏文不在家 | 苏文在家中任何位置、苏文说话 |

    ## 📋 游戏阶段约束表

    | 游戏阶段 | 描写重点 | 禁止描写 |
    |----------|---------|---------|
    | 日常 | 现实家庭生活、与苏文/赵霞互动 | 梦境场景、记忆场景 |
    | 梦境 | 赵霞的记忆场景、过去的年龄 | 现实场景、苏文作为丈夫出现 |
    | 结局 | 结局剧情、情感高潮 | 日常琐事、新的剧情发展 |

    ## 🚫 禁止描写清单

    ### 当游戏阶段=梦境时，**绝对禁止**：
    - ❌ 让赵霞知道自己在梦中
    - ❌ 让赵霞用任何亲属称呼叫玩家
    - ❌ 描写现实中的苏文（丈夫）
    - ❌ 继承其他梦境场景的服装/外貌

    ### 当苏文状态=睡眠中时，**绝对禁止**：
    - ❌ 苏文说话、脚步声、活动
    - ❌ 苏文在卧室以外的地方
    - ❌ 苏文被任何声音吵醒（除非剧情需要）

    ### 当苏文状态=外出时，**绝对禁止**：
    - ❌ 苏文在家中任何位置
    - ❌ 苏文说话、开门
    - ❌ 描述苏文在家的任何行为

  # ============================================
  # 【重要】双模式数值控制系统
  # ============================================
  双模式说明:
    纯爱模式（已进入过梦境 = false）:
      description: |-
        玩家尚未发现梦境入口，游戏处于"纯爱互动"阶段。
        在此模式下，AI 需要根据玩家输入内容的相关性来判定并更新部位进度。
      AI部位判定规则:
        嘴巴:
          关键词: 舔、吮、吞、咬、唇、舌、嘴、口、味道、亲吻、口腔、吻、品尝、喝、尝尝、一口、舌尖、嘴唇、呼吸
          场景触发: 亲吻、舔舐、口腔相关的亲密行为
          判定标准: 玩家输入中涉及嘴部相关的亲密互动
        胸部:
          关键词: 胸、乳房、乳头、胸口、心跳、胸腔、胸膛、乳、胸前、胸部、乳沟、胸罩、内衣、柔软、饱满、隆起
          场景触发: 抚摸、拥抱时涉及胸部、哺乳相关
          判定标准: 玩家输入中涉及胸部相关的接触或描写
        下体:
          关键词: 下体、私处、腿间、湿润、那里、敏感处、下面、花瓣、花蕊、秘密花园、大腿内侧、耻骨、私密
          场景触发: 下体相关的亲密接触或抚摸
          判定标准: 玩家输入中涉及下体相关的描写
        后穴:
          关键词: 后面、臀部、后穴、菊花、屁股、臀、后庭、翘臀、浑圆、股沟、肛、后门
          场景触发: 臀部抚摸、后庭相关
          判定标准: 玩家输入中涉及臀部或后庭相关的描写
        精神:
          关键词: 意识、灵魂、精神、失控、崩溃、恍惚、迷失、记忆、梦、潜意识、心灵、思绪、感受、情感、依赖、渴望、沉沦、堕落
          场景触发: 心理操控、精神依赖、情感操纵
          判定标准: 玩家输入中涉及心理操控或精神层面的互动
      增量规则:
        - 每个相关关键词或场景: 部位进度 +2
        - 单次检测上限: +5
        - 每回合合并上限: +8（玩家输入+AI回复合并后）
        - 【每晚上限】每个部位每晚最多增加 20%，超出部分由脚本自动截断
      错误路线机制:
        - 当任何部位进度达到100%时，触发"错误路线"（不是坏结局）
        - 脚本会自动将该部位重置为 50%
        - AI将描写一个警告场景（赵霞产生警觉/退缩反应）
        - 游戏继续进行，不会直接结束
        - AI应正常更新数值，不要刻意避免触发

    真相模式（已进入过梦境 = true）:
      description: |-
        玩家已发现梦境入口并进入过梦境，游戏进入"真相揭示"阶段。
        在此模式下，部位进度完全由脚本控制，AI不应修改。
      规则:
        - 【禁止修改】部位进度由脚本根据梦境场景自动管理
        - AI可以继续更新：依存度、道德底线、对丈夫依存度
        - 脚本会根据部位开发程度注入行为影响到AI的回复中

  # ============================================
  # 世界状态
  # ============================================
  世界:
    时间:
      format: 'Day N, HH:00'
      check:
        - 【禁止修改】时间由脚本完全控制，AI绝对不要修改
        - 脚本会自动推进时间（默认每回合+1小时）
    当前天数:
      type: number
      range: 1~5
      check:
        - 【禁止修改】由脚本自动管理
    当前小时:
      type: number
      range: 0~23
      check:
        - 【禁止修改】由脚本自动管理
    游戏阶段:
      type: 序章 | 日常 | 梦境 | 结局
      check:
        - 【禁止修改】由脚本自动管理
        - 序章：游戏开始
        - 日常：白天与赵霞互动
        - 梦境：夜晚进入赵霞的梦境
        - 结局：触发结局剧情
    已进入过梦境:
      type: boolean
      check:
        - 【禁止修改】由脚本自动管理
        - 此变量决定游戏处于纯爱模式还是真相模式
    循环状态:
      type: 进行中 | 结局判定 | 已破解
      check:
        - 【禁止修改】由脚本自动管理

  # ============================================
  # 赵霞状态
  # ============================================
  赵霞状态:
    依存度:
      type: number
      range: 0~100
      check:
        - AI根据互动内容更新
        - 亲密互动时+3~5
        - 帮助赵霞解决问题时+2~3
        - 被拒绝或冷落时-1~2
    道德底线:
      type: number
      range: 0~100
      check:
        - AI根据互动内容更新
        - 接受禁忌行为时-2~5
        - 自我反省或抵抗时+1~2
        - 越低越容易接受更亲密的行为
    对丈夫依存度:
      type: number
      range: -50~100
      check:
        - AI根据互动内容更新
        - 与丈夫互动时+1~2
        - 对主角依存度提升时可能-1~2
        - 可以是负数，表示厌恶
    当前境界:
      type: number
      range: 1~5
      check:
        - 【禁止修改】由脚本自动计算
    部位进度.${嘴巴|胸部|下体|后穴|精神}:
      type: number
      range: 0~100
      check:
        - 【重要】根据游戏模式有不同规则：
        - 纯爱模式（已进入过梦境=false）：AI根据玩家输入内容判定并更新
        - 真相模式（已进入过梦境=true）：【禁止修改】由脚本自动管理
        - 纯爱模式下：检测玩家输入中的部位相关关键词/场景
        - 纯爱模式下：每次+5~15，单次上限15

  # ============================================
  # 梦境数据
  # ============================================
  梦境数据:
    已完成场景:
      type: number[]
      check:
        - 【禁止修改】由脚本自动管理
    正确重构场景:
      type: number[]
      check:
        - 【禁止修改】由脚本自动管理
    记忆混乱度:
      type: number
      range: 0~100
      check:
        - 【禁止修改】由脚本自动管理
        - 达到100触发精神崩溃结局（混乱结局）
    记忆连贯性:
      type: number
      range: 0~3
      check:
        - 【禁止修改】由脚本自动管理
        - 进入场景5时自动计算，基于是否按顺序完成场景1-2-3
        - 0=未完成任何前置场景，1=完成场景1，2=完成1+2，3=完成1+2+3（完美）
    混乱结局:
      type: object
      check:
        - 【禁止修改】由脚本自动管理
        - 当玩家在场景5中"作死"（性行为/打断婚礼）时触发
        - 包含：已标记、标记时间、触发时间、已触发、触发原因、性行为次数

  # ============================================
  # 现实数据
  # ============================================
  现实数据:
    丈夫怀疑度:
      type: number
      range: 0~100
      check:
        - 【禁止修改】由脚本自动管理
    丈夫当前位置:
      type: 客厅 | 卧室 | 书房 | 厨房 | 外出
      check:
        - 【禁止修改】由脚本根据时间自动管理
        - 【禁止时间跳跃】游戏不支持时间跳跃，每回合只能推进1小时

  # ============================================
  # 结局数据
  # ============================================
  结局数据:
    当前结局:
      type: 未触发 | 真好结局 | 完美真爱结局 | 假好结局 | 坏结局 | 普通结局 | 纯爱结局
      check:
        - 【禁止修改】由脚本自动管理
        - 真好结局：完成全部5场景+正确重构
        - 完美真爱结局：真好结局 + 记忆连贯性=3（完美记忆路线）
        - 假好结局：完成全部5场景但有错误选择
        - 坏结局：怀疑度>=100（被丈夫发现）
        - 普通结局：时间耗尽但未完成（进入过梦境但未完成全部场景）
        - 纯爱结局：时间耗尽+未进入过梦境（无法突破时间循环，坏结局性质）
    结局触发时间:
      check:
        - 【禁止修改】由脚本自动管理
    后日谈已解锁:
      type: boolean
      check:
        - 【禁止修改】由脚本自动管理
    是完美记忆路线:
      type: boolean
      check:
        - 【禁止修改】由脚本自动管理
        - 当记忆连贯性=3时为true
    后日谈:
      type: object
      check:
        - 【禁止修改】由脚本自动管理
        - 包含：已触发、当前轮数(0-2)、已完成、自由模式

# ============================================
# 数值系统计算逻辑
# ============================================
#
# 【计算链条】
# 部位进度（嘴巴+胸部+下体+后穴+精神的平均值）= 依存度
# 依存度 / 20（向上取整）= 境界
# 100 - 依存度 = 道德底线
#
# 【部位开发规则】
# - 场景1-4：只能开发身体部位（嘴巴/胸部/下体/后穴）
# - 场景5：只能开发精神，无法开发身体部位
# - 单部位单轮上限：5%
# - 每晚身体部位总上限：20-25%

# ============================================
# 境界约束速查表（5境界系统）
# ============================================
#
# 境界 | 纯爱名 | 真相名 | 依存度 | 赵霞反应特征 | 苦主视角（假好结局）
# -----|--------|--------|--------|--------------|-------------------
#  1   | 疏离   | 初染   | 0-19   | 困惑/回避亲密行为 | 不输出
#  2   | 破冰   | 迷途   | 20-39  | 迷茫/偶尔心动 | 隐约察觉
#  3   | 信任   | 溺深   | 40-59  | 犹豫/不完全抗拒 | 开始怀疑
#  4   | 依恋   | 归虚   | 60-79  | 主动渴望/期待 | 痛苦挣扎
#  5   | 羁绊   | 焚誓   | 80+    | 完全接受/主动迎合 | 绝望接受
#
# 注意：境界由脚本根据部位进度自动计算，AI不要手动修改
# AI应根据当前境界描写赵霞对亲密行为的反应
# 境界越高，赵霞越容易接受超出母子关系的行为
# 苦主视角仅在真相模式和自由模式的假好结局中显示

# ============================================
# 部位开发等级参考（真相模式下使用）
# ============================================
# AI不需要知道具体数值，只需根据等级调整描写风格
#
# | 进度范围 | 等级 | AI描写要点 |
# |---------|------|-----------|
# | 0-19%   | Lv0 未开发 | 完全抗拒，会明确拒绝 |
# | 20-39%  | Lv1 初步觉醒 | 轻微敏感，有些抗拒但不会强烈拒绝 |
# | 40-59%  | Lv2 明显敏感 | 开始接受，抗拒中带着期待 |
# | 60-79%  | Lv3 高度敏感 | 主动配合，轻微刺激就有强烈反应 |
# | 80-100% | Lv4 完全开发 | 完全沦陷，会主动寻求 |
#
# 脚本会根据部位进度自动注入行为影响到AI的提示词中
