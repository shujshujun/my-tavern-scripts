# yaml-language-server: $schema=https://testingcf.jsdelivr.net/gh/StageDog/tavern_sync/dist/schema/worldbook.zh.json
锚点:
  - &分隔符
    启用: false
    激活策略:
      类型: 绿灯
    插入位置:
      类型: 角色定义之前
      顺序: 14720
    激活概率: 100
    内容: ''

条目:
  # ============================================
  # 角色设定
  # ============================================
  - 文件夹: 角色
    条目:
      - 名称: ===角色开始===
        <<: *分隔符

      - 名称: 赵霞
        启用: true
        激活策略:
          类型: 绿灯
          关键字:
            - 赵霞
            - 母亲
            - 妈妈
            - 妈
        插入位置:
          类型: 角色定义之前
          顺序: 100
        文件: 角色/赵霞

      - 名称: 主角
        启用: true
        激活策略:
          类型: 绿灯
          关键字:
            - 主角
            - <user>
            - 儿子
        插入位置:
          类型: 角色定义之前
          顺序: 100
        文件: 角色/主角

      - 名称: 苏文
        启用: true
        激活策略:
          类型: 绿灯
          关键字:
            - 苏文
            - 父亲
            - 爸爸
            - 爸
        插入位置:
          类型: 角色定义之前
          顺序: 100
        文件: 角色/苏文

      - 名称: ===角色结束===
        <<: *分隔符

  # ============================================
  # 变量系统
  # ============================================
  - 文件夹: 变量
    条目:
      - 名称: ===变量开始===
        <<: *分隔符

      - 名称: '[initvar]变量初始化勿开'
        启用: false
        激活策略:
          类型: 蓝灯
        插入位置:
          类型: 角色定义之前
          顺序: 14720
        递归:
          不可被其他条目激活: true
          不可激活其他条目: true
        文件: 变量/initvar

      - 名称: 变量列表
        启用: true
        激活策略:
          类型: 蓝灯
        插入位置:
          类型: 指定深度
          角色: 系统
          深度: 0
          顺序: 14720
        递归:
          不可被其他条目激活: true
          不可激活其他条目: true
        文件: 变量/变量列表

      - 名称: '[mvu_update]变量更新规则'
        启用: true
        激活策略:
          类型: 蓝灯
        插入位置:
          类型: 指定深度
          角色: 系统
          深度: 0
          顺序: 14720
        递归:
          不可被其他条目激活: true
          不可激活其他条目: true
        文件: 变量/变量更新规则

      - 名称: '[mvu_update]变量输出格式'
        启用: true
        激活策略:
          类型: 蓝灯
        插入位置:
          类型: 指定深度
          角色: 系统
          深度: 0
          顺序: 14720
        递归:
          不可被其他条目激活: true
          不可激活其他条目: true
        文件: 变量/变量输出格式

      - 名称: ===变量结束===
        <<: *分隔符

  # ============================================
  # 系统设定
  # ============================================
  - 文件夹: 系统设定
    条目:
      - 名称: ===系统设定开始===
        <<: *分隔符

      # ========== 双模式游戏背景 ==========
      # 纯爱模式背景（未进入梦境前显示 - 伪装成温馨亲情故事）
      # 使用绿灯+正则匹配变量中的 "已进入过梦境": false
      # 扫描深度设为100以确保能扫描到变量列表
      - 名称: 游戏背景_纯爱
        启用: true
        激活策略:
          类型: 绿灯
          关键字:
            - /已进入过梦境["']?:\s*false/
          扫描深度: 100
        插入位置:
          类型: 角色定义之前
          顺序: 50
        文件: 系统设定/游戏背景_纯爱

      # 真相模式背景（进入梦境后显示 - 揭示梦境入侵真相）
      - 名称: 游戏背景
        启用: true
        激活策略:
          类型: 绿灯
          关键字:
            - /已进入过梦境["']?:\s*true/
          扫描深度: 100
        插入位置:
          类型: 角色定义之前
          顺序: 50
        文件: 系统设定/游戏背景

      # ========== 梦境/结局系统（已移至脚本注入） ==========
      # 梦境系统 - 已删除，通过 promptInjection.ts 脚本动态注入
      # 根据场景完成状态显示对应场景信息，避免 AI 提前知道后续场景内容

      # 丈夫打断系统已移至脚本 boundaryInterruption.ts 实现
      # 通过系统A事件触发机制自动处理，无需世界书条目

      # 结局系统概述 - 已删除，通过 promptInjection.ts 脚本注入
      # 包含在梦境场景描写指南中一起注入

      # Bug #39 修复：结局描写指南、后日谈、梦境系统现在通过脚本注入（promptInjection.ts）
      # 已删除的条目：梦境系统、结局系统概述、完美真爱结局、真好结局、假好结局、坏结局、混乱结局、普通结局
      # 已删除的后日谈：完美真爱结局_后日谈、真好结局_后日谈、假好结局_后日谈
      # 参见：docs/BUG_REPORT.md - BUG #39

      # 服装妆容系统已移至脚本 appearanceSystem.ts 实现
      # 通过系统提示注入动态生成外观约束，无需世界书条目

      - 名称: 开场白
        启用: true
        激活策略:
          类型: 绿灯
          关键字:
            - 开场
            - 开始
            - Day 1
            - 第一天
        插入位置:
          类型: 角色定义之前
          顺序: 10
        文件: 系统设定/开场白

      - 名称: ===系统设定结束===
        <<: *分隔符
