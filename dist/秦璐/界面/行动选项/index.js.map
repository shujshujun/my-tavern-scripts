{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/./src/秦璐/界面/行动选项/ActionOptions.vue?330c","webpack://tavern_helper_template/src/秦璐/界面/行动选项/ActionOptions.vue?c87a","src://tavern_helper_template/src/秦璐/界面/行动选项/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n    key: 0,\n    class: \"options-container\"\n};\nconst _hoisted_2 = { class: \"options-panel\" };\nconst _hoisted_3 = [\"onClick\"];\nconst _hoisted_4 = { class: \"option-text\" };\nimport { ref, onMounted, nextTick } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ActionOptions',\n    setup(__props) {\n        const options = ref([]);\n        const sendingIndex = ref(-1);\n        const isHiding = ref(false);\n        // 通知 iframe 高度变化\n        const updateIframeHeight = () => {\n            nextTick(() => {\n                // 方法1: 触发 resize 事件让酒馆助手重新计算高度\n                window.dispatchEvent(new Event('resize'));\n                // 方法2: 直接设置 iframe 高度\n                const iframe = window.frameElement;\n                if (iframe) {\n                    const contentHeight = document.body.scrollHeight;\n                    iframe.style.height = contentHeight > 0 ? `${contentHeight}px` : '0px';\n                }\n            });\n        };\n        // 发送到输入框\n        const sendToChatBox = (text) => {\n            if (!text || ['…', '...'].includes(text.trim()) || text.trim().length === 0)\n                return;\n            try {\n                let $textarea = $(parent.document).find('#send_textarea');\n                if ($textarea.length === 0)\n                    $textarea = $('#send_textarea');\n                if ($textarea.length === 0) {\n                    // 降级为直接发送\n                    if (typeof triggerSlash === 'function') {\n                        triggerSlash(`/send ${text}|/trigger`);\n                    }\n                    return;\n                }\n                const currentContent = $textarea.val() || '';\n                if (currentContent.includes(text.trim()))\n                    return;\n                const separator = currentContent.trim() ? '\\n' : '';\n                const newContent = currentContent + separator + text.trim();\n                $textarea.val(newContent);\n                $textarea.trigger('input');\n                $textarea.focus();\n            }\n            catch {\n                if (typeof triggerSlash === 'function') {\n                    triggerSlash(`/send ${text}|/trigger`);\n                }\n            }\n        };\n        // 处理选项点击\n        const handleOptionClick = (option, index) => {\n            if (sendingIndex.value !== -1 || isHiding.value)\n                return;\n            sendingIndex.value = index;\n            // 去除开头的数字序号\n            const textToSend = option.replace(/^\\d+\\.\\s*/, '').trim();\n            sendToChatBox(textToSend);\n            // 隐藏面板\n            setTimeout(() => {\n                isHiding.value = true;\n                options.value = [];\n                // 更新 iframe 高度\n                updateIframeHeight();\n            }, 300);\n        };\n        // 初始化：解析消息中的选项\n        const initOptions = () => {\n            if (typeof getCurrentMessageId !== 'function' || typeof getChatMessages !== 'function')\n                return;\n            const msgId = getCurrentMessageId();\n            const messages = getChatMessages(msgId);\n            if (!messages || messages.length === 0)\n                return;\n            const lastMsg = messages[0];\n            if (!lastMsg || !lastMsg.message)\n                return;\n            const match = lastMsg.message.match(/<options>((?:(?!<options>).)*?)<\\/options>/s);\n            if (match && match[1]) {\n                const parsedOptions = match[1]\n                    .split('|')\n                    .map((o) => o.trim())\n                    .filter((o) => o && !['…', '...'].includes(o));\n                if (parsedOptions.length > 0) {\n                    options.value = parsedOptions;\n                }\n            }\n        };\n        onMounted(() => {\n            setTimeout(initOptions, 300);\n        });\n        return (_ctx, _cache) => {\n            return (options.value.length > 0)\n                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                    _createCommentVNode(\" 背景纹理层 \"),\n                    _cache[3] || (_cache[3] = _createElementVNode(\"div\", { class: \"bg-pattern\" }, null, -1 /* CACHED */)),\n                    _createCommentVNode(\" 主面板 \"),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createCommentVNode(\" 顶部装饰线 \"),\n                        _cache[1] || (_cache[1] = _createElementVNode(\"div\", { class: \"panel-decor\" }, null, -1 /* CACHED */)),\n                        _createCommentVNode(\" 标题 \"),\n                        _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"options-header\" }, [\n                            _createElementVNode(\"span\", { class: \"decor-line\" }),\n                            _createElementVNode(\"span\", { class: \"title\" }, \"命运抉择\"),\n                            _createElementVNode(\"span\", { class: \"decor-line\" })\n                        ], -1 /* CACHED */)),\n                        _createCommentVNode(\" 选项网格 \"),\n                        _createElementVNode(\"div\", {\n                            class: _normalizeClass(['options-grid', { 'grid-4col': options.value.length >= 6 }])\n                        }, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(options.value, (option, index) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: index,\n                                    class: _normalizeClass(['option-btn', { sending: sendingIndex.value === index }]),\n                                    style: _normalizeStyle({ animationDelay: index * 0.08 + 's' }),\n                                    onClick: ($event) => (handleOptionClick(option, index))\n                                }, [\n                                    _cache[0] || (_cache[0] = _createElementVNode(\"span\", { class: \"option-icon\" }, \"◇\", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", _hoisted_4, _toDisplayString(option), 1 /* TEXT */)\n                                ], 14 /* CLASS, STYLE, PROPS */, _hoisted_3));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ], 2 /* CLASS */)\n                    ])\n                ]))\n                : _createCommentVNode(\"v-if\", true);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ActionOptions.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ActionOptions.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./ActionOptions.vue?vue&type=style&index=0&id=6b7d1a3a&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6b7d1a3a\"]])\n\nexport default __exports__","import { createApp } from 'vue';\nimport ActionOptions from './ActionOptions.vue';\n\n$(() => {\n  const app = createApp(ActionOptions);\n  app.mount('#app');\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","__name","setup","__props","options","ref","sendingIndex","isHiding","handleOptionClick","option","index","value","text","includes","trim","length","$textarea","$","parent","document","find","triggerSlash","currentContent","separator","newContent","trigger","focus","sendToChatBox","replace","setTimeout","nextTick","window","dispatchEvent","Event","iframe","frameElement","contentHeight","body","scrollHeight","style","height","initOptions","getCurrentMessageId","getChatMessages","msgId","messages","lastMsg","message","match","parsedOptions","split","map","o","filter","onMounted","_ctx","_cache","sending","animationDelay","onClick","$event","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","createApp","ActionOptions","mount"],"ignoreList":[],"sourceRoot":""}