{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/秦璐/schema.ts","src://tavern_helper_template/src/秦璐/脚本/变量结构/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { z } from 'zod';\n\n// ============================================\n// 基础类型定义\n// ============================================\n\n/** 阶段标题（5阶段系统） */\nconst StageTitle = z.enum([\n  '抵抗',\n  '动摇',\n  '沉溺',\n  '疯狂',\n  '圆满',\n]);\n\n/** 念头难度 */\nconst ThoughtDifficulty = z.enum(['简单', '中等', '困难', '待定']);\n\n/** 苏文状态枚举 */\nconst SuwenStatus = z.enum(['在家', '出差', '上班', '睡眠']);\n\n// ============================================\n// 复合结构定义\n// ============================================\n\n/** 念头培育区中的念头 */\nconst TemporaryThought = z.object({\n  念头内容: z.string(),\n  植入时间: z.string().describe('格式: YYYY/MM/DD HH:mm'),\n  过期时间: z.string().describe('植入时间+24h'),\n  需要时间: z.coerce.number().describe('3-5小时，根据难度计算；待判定时为0'),\n  难度等级: ThoughtDifficulty.default('中等'),\n  开发进度: z.coerce.number().default(0).describe('累积的相关互动时间（小时）'),\n  待判定: z.boolean().default(false).describe('本地无法匹配类型时为true，等待AI判定'),\n});\n\n/** 习惯 */\nconst Habit = z.object({\n  内容: z.string().describe('具体的行为或思维模式'),\n  形成时间: z.string().describe('格式: YYYY/MM/DD HH:mm'),\n});\n\n/** 服装细节 */\nconst ClothingDetails = z.object({\n  头部: z.string().default('无').describe('发饰、头饰等'),\n  上装: z.string().default('米色针织开衫'),\n  下装: z.string().default('深灰长裙'),\n  内衣: z.object({\n    上: z.string().default('肉色棉质文胸'),\n    下: z.string().default('棉质内裤'),\n  }).default({}),\n  袜裤: z.string().default('肉色丝袜'),\n  鞋子: z.string().default('室内拖鞋'),\n  外套: z.string().default('无').describe('大衣、披肩等'),\n  配饰: z.string().default('婚戒').describe('首饰、手表等'),\n  特殊装饰: z.string().default('无').describe('项圈、手铐等'),\n  整体风格: z.string().default('居家贤妻'),\n  暴露程度: z.enum(['保守', '正常', '清凉', '暴露', '极度暴露']).default('正常'),\n  整洁度: z.enum(['整洁', '略显凌乱', '凌乱', '破损', '衣不蔽体']).default('整洁'),\n});\n\n/** 妆容细节 */\nconst MakeupDetails = z.object({\n  底妆: z.string().default('素颜淡妆'),\n  眼妆: z.string().default('无'),\n  唇妆: z.string().default('淡粉色唇彩'),\n  腮红: z.string().default('自然红晕'),\n  特殊妆容: z.string().default('无').describe('纹身妆、泪痕妆等'),\n  整体风格: z.string().default('清新自然'),\n  浓淡程度: z.enum(['素颜', '淡妆', '日常妆', '浓妆', '艳妆']).default('淡妆'),\n});\n\n/** 身体改造 */\nconst BodyModification = z.object({\n  纹身: z.record(z.string(), z.string()).default({}).describe('部位: 纹身内容'),\n  穿刺: z.object({\n    耳环: z.boolean().default(false),\n    乳环: z.boolean().default(false),\n    乳头环: z.boolean().default(false),\n    阴蒂环: z.boolean().default(false),\n    舌环: z.boolean().default(false),\n    肚脐环: z.boolean().default(false),\n    阴唇环: z.boolean().default(false),\n    其他: z.array(z.string()).default([]),\n  }).default({}),\n  乳晕改造: z.string().default('无').describe('如：增大、变色、穿刺等'),\n  永久标记: z.array(z.string()).default([]).describe('烙印、伤疤等'),\n  临时标记: z.array(z.string()).default([]).describe('吻痕、精液痕迹等'),\n  体态变化: z.string().default('无').describe('因开发导致的身体变化'),\n});\n\n// ============================================\n// 角色状态定义\n// ============================================\n\n/** 秦璐/苏梦状态 */\nconst CharacterState = z.object({\n  // ━━━━━━ 核心三维数值 ━━━━━━\n  道德底线: z.coerce.number().transform(v => _.clamp(v, 0, 100)).default(90),\n  对主角依存度: z.coerce.number().transform(v => _.clamp(v, -50, 100)).default(20),\n  对苏文依存度: z.coerce.number().transform(v => _.clamp(v, -50, 100)).default(80),\n\n  // ━━━━━━ 派生数值 ━━━━━━\n  潜意识侵蚀度: z.coerce.number().transform(v => _.clamp(v, 0, 150)).default(0),\n  当前阶段: z.coerce.number().transform(v => _.clamp(v, 1, 5)).default(1),\n  阶段标题: StageTitle.default('抵抗'),\n\n  // ━━━━━━ 心理状态 ━━━━━━\n  当前心理想法: z.string().default('').describe('秦璐当前的内心独白，AI每轮更新'),\n  当前情绪: z.string().default('平静'),\n\n  // ━━━━━━ 外在表现 ━━━━━━\n  服装细节: ClothingDetails.default({}),\n  妆容细节: MakeupDetails.default({}),\n  身体改造: BodyModification.default({}),\n  气质描述: z.string().default('温柔贤淑的家庭主妇'),\n\n  // ━━━━━━ 习惯系统 ━━━━━━\n  习惯列表: z.array(Habit).default([]),\n  念头培育区: z.array(TemporaryThought).transform(thoughts => {\n    // 自动去重：基于念头内容\n    const seen = new Set<string>();\n    return thoughts.filter(thought => {\n      if (seen.has(thought.念头内容)) {\n        return false;\n      }\n      seen.add(thought.念头内容);\n      return true;\n    });\n  }).default([]),\n});\n\n/** 苏文位置枚举 */\nconst SuwenLocation = z.enum(['客厅', '餐厅', '厨房', '主卧', '浴室', '主角房间', '外面']);\n\n/** 疑心值冻结状态 */\nconst SuspicionFreeze = z.object({\n  是否冻结: z.boolean().default(false),\n  借口内容: z.string().default(''),\n  冻结开始时间: z.string().default(''),\n  冻结结束时间: z.string().default(''),\n});\n\n/** 印象结构（基础印象 + AI细节描述） */\nconst Impression = z.object({\n  基础印象: z.string().default('').describe('由脚本根据疑心值自动生成，AI不要修改'),\n  细节描述: z.string().default('').describe('AI可以补充具体原因，不超过20字'),\n});\n\n/** 安眠药状态 */\nconst SleepingPillState = z.object({\n  是否生效: z.boolean().default(false).describe('安眠药是否正在生效'),\n  生效开始时间: z.string().default('').describe('安眠药开始生效的时间，格式: YYYY/MM/DD HH:mm'),\n  生效结束时间: z.string().default('').describe('安眠药失效的时间（6小时后），格式: YYYY/MM/DD HH:mm'),\n  剩余时间: z.coerce.number().default(0).describe('剩余生效时间（小时）'),\n  上次使用时间: z.string().default('').describe('上次使用安眠药的时间，用于48小时冷却判定'),\n  触发楼层: z.coerce.number().default(-1).describe('触发安眠药的消息楼层ID，用于ROLL时判断是否重复触发'),\n});\n\n/** 头孢+酒住院状态（终极隐藏模式） */\nconst HospitalizationState = z.object({\n  是否住院: z.boolean().default(false).describe('苏文是否因头孢+酒住院'),\n  住院开始时间: z.string().default('').describe('住院开始时间，格式: YYYY/MM/DD HH:mm'),\n  住院结束时间: z.string().default('').describe('住院结束时间（15天后），格式: YYYY/MM/DD HH:mm'),\n  剩余天数: z.coerce.number().default(0).describe('剩余住院天数'),\n  触发楼层: z.coerce.number().default(-1).describe('触发住院的消息楼层ID，用于ROLL时判断是否重复触发'),\n});\n\n/** 苏文状态 */\nconst SuwenState = z.object({\n  当前状态: SuwenStatus.default('在家'),\n  当前位置: SuwenLocation.default('客厅').describe('苏文当前所在位置'),\n  当前情绪: z.string().default('平静'),\n\n  // 安眠药状态\n  安眠药状态: SleepingPillState.default({}),\n\n  // 头孢+酒住院状态（终极隐藏模式）\n  住院状态: HospitalizationState.default({}),\n\n  // 对秦璐的疑心与印象\n  对秦璐疑心值: z.coerce.number().transform(v => _.clamp(v, 0, 100)).default(0),\n  对秦璐印象: Impression.default({ 基础印象: '我的贤内助', 细节描述: '' }),\n  对秦璐疑心值冻结: SuspicionFreeze.default({}),\n\n  // 对苏梦的疑心与印象\n  对苏梦疑心值: z.coerce.number().transform(v => _.clamp(v, 0, 100)).default(0),\n  对苏梦印象: Impression.default({ 基础印象: '我的乖女儿', 细节描述: '' }),\n  对苏梦疑心值冻结: SuspicionFreeze.default({}),\n});\n\n// ============================================\n// 世界状态定义\n// ============================================\n\nconst WorldState = z.object({\n  时间: z.string().default('07:30').describe('格式: HH:mm'),\n  日期: z.string().default('2024/11/20').describe('格式: YYYY/MM/DD'),\n  星期: z.enum(['周一', '周二', '周三', '周四', '周五', '周六', '周日']).default('周三').describe('根据日期自动计算'),\n  地点: z.string().default('家 - 客厅'),\n  环境氛围: z.string().default('日常'),\n});\n\n// ============================================\n// 系统追踪定义\n// ============================================\n\n/** 外观待更新标记 */\nconst AppearancePendingUpdate = z.object({\n  需要更新: z.boolean().default(false).describe('阶段变化时设为true，外观更新后设为false'),\n  目标阶段: z.coerce.number().default(0).describe('需要更新到的目标阶段'),\n  变化原因: z.string().default('').describe('如：阶段提升、剧情换装等'),\n});\n\n/** 苏文打断事件（方案3：直接触发+借口判定） */\nconst SuwenInterruption = z.object({\n  待触发: z.boolean().default(false).describe('是否有待触发的打断事件'),\n  已通知AI: z.boolean().default(false).describe('是否已通过系统消息通知AI'),\n  打断原因: z.string().default('').describe('如：在主角房间停留过久'),\n  累计时间: z.coerce.number().default(0).describe('触发打断时的累计危险时间'),\n  // 借口判定相关（玩家下一轮输入借口，AI判定成功/失败）\n  等待借口: z.boolean().default(false).describe('是否正在等待玩家输入借口'),\n  借口结果: z.enum(['待定', '成功', '失败']).default('待定').describe('借口判定结果'),\n});\n\n/** 苏文巡逻事件（新逻辑：设置离开期限） */\nconst SuwenPatrol = z.object({\n  待触发: z.boolean().default(false).describe('是否有待触发的巡逻事件'),\n  已通知AI: z.boolean().default(false).describe('是否已通过系统消息通知AI'),\n  触发时间: z.string().default('').describe('巡逻触发的时间'),\n  巡逻位置: z.string().default('').describe('苏文巡逻经过的位置'),\n  上次巡逻时间: z.string().default('').describe('上次巡逻触发的时间，用于冷却'),\n  // 离开期限相关（苏文要求1-2小时内离开，超时触发打断事件）\n  离开期限: z.string().default('').describe('苏文要求离开的截止时间，格式: HH:mm'),\n  期限小时数: z.coerce.number().default(0).describe('苏文设置的离开期限小时数（1-2小时）'),\n});\n\n/** 念头植入日志 */\nconst ThoughtImplantLog = z.object({\n  目标: z.enum(['秦璐', '苏梦']),\n  内容: z.string(),\n  植入时间: z.string().describe('格式: YYYY/MM/DD HH:mm'),\n  植入楼层: z.coerce.number().describe('记录植入时的消息楼层ID'),\n  已通知AI: z.boolean().default(false).describe('是否已通过系统消息通知AI'),\n});\n\n/** 强制事件日志（阶段突破/打断/巡逻，支持ROLL后重新触发） */\nconst ForcedEventLog = z.object({\n  事件类型: z.enum(['阶段突破', '苏文打断', '苏文巡逻']),\n  角色: z.enum(['秦璐', '苏梦']),\n  触发楼层: z.coerce.number().describe('记录触发时的消息楼层ID'),\n  触发时间: z.string().describe('格式: YYYY/MM/DD HH:mm'),\n  已通知AI: z.boolean().default(false).describe('是否已通过用户消息替换通知AI'),\n  // 事件特定数据\n  阶段号: z.coerce.number().optional().describe('阶段突破时的新阶段'),\n  累计时间: z.coerce.number().optional().describe('打断事件时的累计危险时间'),\n  打断原因: z.string().optional().describe('打断事件的原因'),\n  巡逻位置: z.string().optional().describe('巡逻事件的位置'),\n});\n\nconst SystemTracking = z.object({\n  当前所在位置: z.string().default('客厅'),\n  当前角色: z.enum(['秦璐', '苏梦']).default('秦璐').describe('当前所在位置的是哪个角色'),\n  进入当前位置时间: z.string().default(''),\n  上次更新时间: z.string().default(''),\n  上次衰减日期: z.string().default('').describe('上次疑心值自然衰减的日期，格式: YYYY/MM/DD'),\n  危险时间累计: z.coerce.number().default(0).describe('【已废弃】兼容旧数据，新逻辑使用角色独立的危险时间累计'),\n  秦璐危险时间累计: z.coerce.number().default(0).describe('秦璐在主角房间且苏文在家清醒的累计小时数'),\n  苏梦危险时间累计: z.coerce.number().default(0).describe('苏梦在主角房间且苏文在家清醒的累计小时数'),\n  秦璐外观待更新: AppearancePendingUpdate.default({}),\n  苏梦外观待更新: AppearancePendingUpdate.default({}),\n  苏文打断事件: SuwenInterruption.default({}),\n  苏文巡逻事件: SuwenPatrol.default({}),\n\n  // 念头植入日志系统（解决ROLL消息后注入丢失问题）\n  念头植入日志: z.array(ThoughtImplantLog).default([]).describe('记录待通知AI的念头植入操作'),\n\n  // 强制事件日志系统（阶段突破/打断/巡逻，支持ROLL后重新触发）\n  强制事件日志: z.array(ForcedEventLog).default([]).describe('记录待通知AI的强制事件'),\n});\n\n// ============================================\n// 主 Schema\n// ============================================\n\nexport const Schema = z.object({\n  世界: WorldState.default({}),\n\n  秦璐状态: CharacterState.default({}),\n\n  苏梦状态: CharacterState.default({\n    道德底线: 85,\n    对主角依存度: 25,\n    对苏文依存度: 70,\n    服装细节: {\n      头部: '黑色发圈',\n      上装: '白色棉麻衬衫',\n      下装: '浅蓝牛仔裤',\n      内衣: {\n        上: '白色蕾丝文胸',\n        下: '白色棉质内裤',\n      },\n      袜裤: '白色短袜',\n      鞋子: '帆布鞋',\n      整体风格: '青春休闲',\n    },\n    妆容细节: {\n      浓淡程度: '素颜',\n    },\n    气质描述: '活泼开朗的大学生',\n  }),\n\n  苏文状态: SuwenState.default({}),\n\n  系统追踪: SystemTracking.default({}),\n});\n\nexport type SchemaType = z.infer<typeof Schema>;\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\nimport { Schema } from '../../schema';\n\n// 立即初始化 fusion_hint 变量，确保世界书读取时不会报错\nupdateVariablesWith(vars => {\n  if (!_.has(vars, 'fusion_hint')) {\n    _.set(vars, 'fusion_hint', '');\n  }\n  return vars;\n}, { type: 'global' });\n\n$(() => {\n  console.info('[秦璐] 注册 MVU Schema');\n  registerMvuSchema(Schema);\n  console.info('[秦璐] MVU Schema 注册完成');\n});\n"],"names":["z","StageTitle","enum","ThoughtDifficulty","SuwenStatus","TemporaryThought","object","string","describe","coerce","number","default","boolean","Habit","ClothingDetails","MakeupDetails","BodyModification","record","array","CharacterState","transform","v","_","clamp","thoughts","seen","Set","filter","thought","has","add","SuwenLocation","SuspicionFreeze","Impression","SleepingPillState","HospitalizationState","SuwenState","WorldState","AppearancePendingUpdate","SuwenInterruption","SuwenPatrol","ThoughtImplantLog","ForcedEventLog","optional","SystemTracking","Schema","updateVariablesWith","vars","set","type","$","console","info"],"ignoreList":[],"sourceRoot":""}