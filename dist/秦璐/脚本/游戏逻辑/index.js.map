{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src//schema.ts","src://tavern_helper_template/src////timeAdvance.ts","src://tavern_helper_template/src//stageConfig.ts","src://tavern_helper_template/src////thoughtCheck.ts","src://tavern_helper_template/src////impression.ts","src://tavern_helper_template/src////appearance.ts","src://tavern_helper_template/src//thoughtCategoryLib.ts","src://tavern_helper_template/src////index.ts","src://tavern_helper_template/src////logCleanup.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { z } from 'zod';\n\n// ============================================\n// \n// ============================================\n\n/** 5 */\nconst StageTitle = z.enum([\n  '',\n  '',\n  '',\n  '',\n  '',\n]);\n\n/**  */\nconst ThoughtDifficulty = z.enum(['', '', '', '']);\n\n/**  */\nconst SuwenStatus = z.enum(['', '', '', '']);\n\n// ============================================\n// \n// ============================================\n\n/**  */\nconst TemporaryThought = z.object({\n  : z.string(),\n  : z.string().describe(': YYYY/MM/DD HH:mm'),\n  : z.string().describe('+24h'),\n  : z.coerce.number().describe('3-50'),\n  : ThoughtDifficulty.default(''),\n  : z.coerce.number().default(0).describe(''),\n  : z.boolean().default(false).describe('trueAI'),\n});\n\n/**  */\nconst Habit = z.object({\n  : z.string().describe(''),\n  : z.string().describe(': YYYY/MM/DD HH:mm'),\n});\n\n/**  */\nconst ClothingDetails = z.object({\n  : z.string().default('').describe(''),\n  : z.string().default(''),\n  : z.string().default(''),\n  : z.object({\n    : z.string().default(''),\n    : z.string().default(''),\n  }).default({}),\n  : z.string().default(''),\n  : z.string().default(''),\n  : z.string().default('').describe(''),\n  : z.string().default('').describe(''),\n  : z.string().default('').describe(''),\n  : z.string().default(''),\n  : z.enum(['', '', '', '', '']).default(''),\n  : z.enum(['', '', '', '', '']).default(''),\n});\n\n/**  */\nconst MakeupDetails = z.object({\n  : z.string().default(''),\n  : z.string().default(''),\n  : z.string().default(''),\n  : z.string().default(''),\n  : z.string().default('').describe(''),\n  : z.string().default(''),\n  : z.enum(['', '', '', '', '']).default(''),\n});\n\n/**  */\nconst BodyModification = z.object({\n  : z.record(z.string(), z.string()).default({}).describe(': '),\n  : z.object({\n    : z.boolean().default(false),\n    : z.boolean().default(false),\n    : z.boolean().default(false),\n    : z.boolean().default(false),\n    : z.boolean().default(false),\n    : z.boolean().default(false),\n    : z.boolean().default(false),\n    : z.array(z.string()).default([]),\n  }).default({}),\n  : z.string().default('').describe(''),\n  : z.array(z.string()).default([]).describe(''),\n  : z.array(z.string()).default([]).describe(''),\n  : z.string().default('').describe(''),\n});\n\n// ============================================\n// \n// ============================================\n\n/** / */\nconst CharacterState = z.object({\n  //   \n  : z.coerce.number().transform(v => _.clamp(v, 0, 100)).default(90),\n  : z.coerce.number().transform(v => _.clamp(v, -50, 100)).default(20),\n  : z.coerce.number().transform(v => _.clamp(v, -50, 100)).default(80),\n\n  //   \n  : z.coerce.number().transform(v => _.clamp(v, 0, 150)).default(0),\n  : z.coerce.number().transform(v => _.clamp(v, 1, 5)).default(1),\n  : StageTitle.default(''),\n\n  //   \n  : z.string().default('').describe('AI'),\n  : z.string().default(''),\n\n  //   \n  : ClothingDetails.default({}),\n  : MakeupDetails.default({}),\n  : BodyModification.default({}),\n  : z.string().default(''),\n\n  //   \n  : z.array(Habit).default([]),\n  : z.array(TemporaryThought).transform(thoughts => {\n    // \n    const seen = new Set<string>();\n    return thoughts.filter(thought => {\n      if (seen.has(thought.)) {\n        return false;\n      }\n      seen.add(thought.);\n      return true;\n    });\n  }).default([]),\n});\n\n/**  */\nconst SuwenLocation = z.enum(['', '', '', '', '', '', '']);\n\n/**  */\nconst SuspicionFreeze = z.object({\n  : z.boolean().default(false),\n  : z.string().default(''),\n  : z.string().default(''),\n  : z.string().default(''),\n});\n\n/**  + AI */\nconst Impression = z.object({\n  : z.string().default('').describe('AI'),\n  : z.string().default('').describe('AI20'),\n});\n\n/**  */\nconst SleepingPillState = z.object({\n  : z.boolean().default(false).describe(''),\n  : z.string().default('').describe(': YYYY/MM/DD HH:mm'),\n  : z.string().default('').describe('6: YYYY/MM/DD HH:mm'),\n  : z.coerce.number().default(0).describe(''),\n  : z.string().default('').describe('48'),\n  : z.coerce.number().default(-1).describe('IDROLL'),\n});\n\n/** + */\nconst HospitalizationState = z.object({\n  : z.boolean().default(false).describe('+'),\n  : z.string().default('').describe(': YYYY/MM/DD HH:mm'),\n  : z.string().default('').describe('15: YYYY/MM/DD HH:mm'),\n  : z.coerce.number().default(0).describe(''),\n  : z.coerce.number().default(-1).describe('IDROLL'),\n});\n\n/**  */\nconst SuwenState = z.object({\n  : SuwenStatus.default(''),\n  : SuwenLocation.default('').describe(''),\n  : z.string().default(''),\n\n  // \n  : SleepingPillState.default({}),\n\n  // +\n  : HospitalizationState.default({}),\n\n  // \n  : z.coerce.number().transform(v => _.clamp(v, 0, 100)).default(0),\n  : Impression.default({ : '', : '' }),\n  : SuspicionFreeze.default({}),\n\n  // \n  : z.coerce.number().transform(v => _.clamp(v, 0, 100)).default(0),\n  : Impression.default({ : '', : '' }),\n  : SuspicionFreeze.default({}),\n});\n\n// ============================================\n// \n// ============================================\n\nconst WorldState = z.object({\n  : z.string().default('07:30').describe(': HH:mm'),\n  : z.string().default('2024/11/20').describe(': YYYY/MM/DD'),\n  : z.enum(['', '', '', '', '', '', '']).default('').describe(''),\n  : z.string().default(' - '),\n  : z.string().default(''),\n});\n\n// ============================================\n// \n// ============================================\n\n/**  */\nconst AppearancePendingUpdate = z.object({\n  : z.boolean().default(false).describe('truefalse'),\n  : z.coerce.number().default(0).describe(''),\n  : z.string().default('').describe(''),\n});\n\n/** 3+ */\nconst SuwenInterruption = z.object({\n  : z.boolean().default(false).describe(''),\n  AI: z.boolean().default(false).describe('AI'),\n  : z.string().default('').describe(''),\n  : z.coerce.number().default(0).describe(''),\n  // AI/\n  : z.boolean().default(false).describe(''),\n  : z.enum(['', '', '']).default('').describe(''),\n});\n\n/**  */\nconst SuwenPatrol = z.object({\n  : z.boolean().default(false).describe(''),\n  AI: z.boolean().default(false).describe('AI'),\n  : z.string().default('').describe(''),\n  : z.string().default('').describe(''),\n  : z.string().default('').describe(''),\n  // 1-2\n  : z.string().default('').describe(': HH:mm'),\n  : z.coerce.number().default(0).describe('1-2'),\n});\n\n/**  */\nconst ThoughtImplantLog = z.object({\n  : z.enum(['', '']),\n  : z.string(),\n  : z.string().describe(': YYYY/MM/DD HH:mm'),\n  : z.coerce.number().describe('ID'),\n  AI: z.boolean().default(false).describe('AI'),\n});\n\n/** //ROLL */\nconst ForcedEventLog = z.object({\n  : z.enum(['', '', '']),\n  : z.enum(['', '']),\n  : z.coerce.number().describe('ID'),\n  : z.string().describe(': YYYY/MM/DD HH:mm'),\n  AI: z.boolean().default(false).describe('AI'),\n  // \n  : z.coerce.number().optional().describe(''),\n  : z.coerce.number().optional().describe(''),\n  : z.string().optional().describe(''),\n  : z.string().optional().describe(''),\n});\n\nconst SystemTracking = z.object({\n  : z.string().default(''),\n  : z.enum(['', '']).default('').describe(''),\n  : z.string().default(''),\n  : z.string().default(''),\n  : z.string().default('').describe(': YYYY/MM/DD'),\n  : z.coerce.number().default(0).describe(''),\n  : z.coerce.number().default(0).describe(''),\n  : z.coerce.number().default(0).describe(''),\n  : AppearancePendingUpdate.default({}),\n  : AppearancePendingUpdate.default({}),\n  : SuwenInterruption.default({}),\n  : SuwenPatrol.default({}),\n\n  // ROLL\n  : z.array(ThoughtImplantLog).default([]).describe('AI'),\n\n  // //ROLL\n  : z.array(ForcedEventLog).default([]).describe('AI'),\n});\n\n// ============================================\n//  Schema\n// ============================================\n\nexport const Schema = z.object({\n  : WorldState.default({}),\n\n  : CharacterState.default({}),\n\n  : CharacterState.default({\n    : 85,\n    : 25,\n    : 70,\n    : {\n      : '',\n      : '',\n      : '',\n      : {\n        : '',\n        : '',\n      },\n      : '',\n      : '',\n      : '',\n    },\n    : {\n      : '',\n    },\n    : '',\n  }),\n\n  : SuwenState.default({}),\n\n  : SystemTracking.default({}),\n});\n\nexport type SchemaType = z.infer<typeof Schema>;\n","/**\n * \n * \n *\n * \n * - 1\n * - \n * - AI//\n */\n\nimport type { SchemaType } from '../../schema';\n\n// ==========  ==========\ninterface TimeJumpRule {\n  keywords: string[];\n  hours?: number;        // \n  days?: number;         // \n  targetHour?: number;   // 8\n  nextDay?: boolean;     // \n}\n\nconst TIME_JUMP_RULES: TimeJumpRule[] = [\n  // \n  { keywords: ['', ''], days: 7 },\n  { keywords: ['', ''], days: 5 },\n  { keywords: [''], days: 1 },\n  { keywords: [''], days: 2 },\n  { keywords: [''], days: 3 },\n  { keywords: [''], days: 30 },\n  { keywords: [''], days: 90 },\n  { keywords: [''], days: 180 },\n  { keywords: [''], days: 365 },\n\n  // \n  { keywords: ['', '', '', ''], nextDay: true, targetHour: 8 },\n  { keywords: [''], days: 2, targetHour: 8 },\n  { keywords: [''], days: 3, targetHour: 8 },\n\n  // \n  { keywords: ['', ''], hours: 3 },\n  { keywords: [''], hours: 1 },\n  { keywords: [''], hours: 2 },\n  { keywords: [''], hours: 3 },\n  { keywords: [''], hours: 1 }, // 1\n  { keywords: ['', '', ''], hours: 2 },\n\n  // \n  { keywords: ['', '', ''], targetHour: 7 },\n  { keywords: [''], targetHour: 10 },\n  { keywords: ['', ''], targetHour: 12 },\n  { keywords: [''], targetHour: 15 },\n  { keywords: ['', ''], targetHour: 18 },\n  { keywords: [''], targetHour: 20 },\n  { keywords: ['', ''], targetHour: 23 },\n  { keywords: [''], nextDay: true, targetHour: 2 },\n\n  // \n  { keywords: ['', ''], targetHour: 8 },\n  { keywords: ['', ''], targetHour: 12 },\n  { keywords: ['', ''], targetHour: 19 },\n  { keywords: ['', ''], targetHour: 22 },\n  { keywords: [''], targetHour: 7 },\n  { keywords: ['', ''], targetHour: 18 },\n\n  // \n  { keywords: ['', '', ''], hours: 3 }, // 3\n];\n\n/**\n * \n * @param userInput \n * @param currentHour \n * @returns 0+1\n */\nfunction detectTimeJump(userInput: string, currentHour: number): number {\n  if (!userInput) return 0;\n\n  // /+/\n  // \"\"\"\"\"\"\n  const specialItemPatterns = [\n    // \n    '.*', '.*', '', '', '',\n    '', '', '', '',\n    // \n    '', '', '', '', '', '',\n    '', '', '', '', '', '',\n  ];\n  const hasSpecialItemKeyword = specialItemPatterns.some(pattern => {\n    const regex = new RegExp(pattern, 'i');\n    return regex.test(userInput);\n  });\n\n  if (hasSpecialItemKeyword) {\n    console.info('[] /+1');\n    return 0; // +1\n  }\n\n  for (const rule of TIME_JUMP_RULES) {\n    const matched = rule.keywords.some(keyword => userInput.includes(keyword));\n    if (!matched) continue;\n\n    console.info(`[] : ${rule.keywords.find(k => userInput.includes(k))}`);\n\n    // \n    if (rule.days !== undefined) {\n      let hours = rule.days * 24;\n      // \n      if (rule.targetHour !== undefined) {\n        const hoursUntilTarget = (rule.targetHour - currentHour + 24) % 24;\n        hours = (rule.days - 1) * 24 + hoursUntilTarget;\n        if (hoursUntilTarget === 0) hours += 24; // \n      }\n      console.info(`[] : ${rule.days} = ${hours}`);\n      return hours;\n    }\n\n    // \n    if (rule.hours !== undefined) {\n      console.info(`[] : ${rule.hours}`);\n      return rule.hours;\n    }\n\n    // \n    if (rule.targetHour !== undefined) {\n      let hoursUntilTarget = rule.targetHour - currentHour;\n\n      // \n      if (rule.nextDay || hoursUntilTarget <= 0) {\n        hoursUntilTarget += 24;\n      }\n\n      console.info(`[] : ${currentHour}  ${rule.targetHour} = ${hoursUntilTarget}`);\n      return hoursUntilTarget;\n    }\n  }\n\n  return 0; // +1\n}\n\n// ==========  ==========\n// LOCATION_KEYWORDS  . \n\nconst SPACE_GROUPS: Record<string, string[]> = {\n  : ['', '', ''],\n  : [''],\n  : [''],\n  : [''],\n  : [''],\n  : [''],\n};\n\nfunction getSpaceGroup(location: string): string | null {\n  for (const [group, locations] of Object.entries(SPACE_GROUPS)) {\n    if (locations.includes(location)) return group;\n  }\n  return null;\n}\n\nfunction isSameSpace(location1: string, location2: string): boolean {\n  const group1 = getSpaceGroup(location1);\n  const group2 = getSpaceGroup(location2);\n  if (!group1 || !group2) return false;\n  return group1 === group2;\n}\n\n// matchLocation  . \n\nexport function parseTime(timeStr: string, dateStr: string): Date {\n  const [year, month, day] = dateStr.split('/').map(Number);\n  const [hour, minute] = timeStr.split(':').map(Number);\n  return new Date(year, month - 1, day, hour, minute);\n}\n\n// ==========  ==========\nconst SLEEPING_PILL_KEYWORDS = [\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n];\n\n// - 48 = 2\nconst SLEEPING_PILL_COOLDOWN_HOURS = 48;\n\n// ========== + ==========\nconst HOSPITALIZATION_KEYWORDS = [\n  //  + \n  '.*', '.*',\n  '.*', '.*',\n  '.*', '.*',\n  // \n  '', '.*', '.*',\n  '.*', '.*',\n  '.*', '.*',\n  // \n  '', '',\n  // \n  '', '',\n  '', '',\n];\n\n// - 15\nconst HOSPITALIZATION_DAYS = 15;\n\n/**\n * \n */\nfunction detectSleepingPill(text: string): boolean {\n  if (!text) return false;\n  return SLEEPING_PILL_KEYWORDS.some(keyword => text.includes(keyword));\n}\n\n/**\n * +\n */\nfunction detectHospitalization(text: string): boolean {\n  if (!text) return false;\n  //  .* \n  return HOSPITALIZATION_KEYWORDS.some(pattern => {\n    const regex = new RegExp(pattern, 'i');\n    return regex.test(text);\n  });\n}\n\n/**\n * +\n * @param data \n * @param currentDate \n * @param currentTime \n * @param currentFloor IDROLL\n * @returns \n */\nfunction activateHospitalization(data: SchemaType, currentDate: string, currentTime: string, currentFloor: number): boolean {\n  const hospState = data..;\n  const lastTriggerFloor = hospState?. ?? -1;\n\n  // ROLLtrue\n  if (lastTriggerFloor === currentFloor && hospState?.) {\n    console.info(`[+] ROLL${currentFloor}`);\n    return true;\n  }\n\n  // \n  if (hospState?.) {\n    console.warn('[+] ');\n    return false;\n  }\n\n  const startTime = parseTime(currentTime, currentDate);\n  const endTime = new Date(startTime.getTime());\n  endTime.setDate(endTime.getDate() + HOSPITALIZATION_DAYS); // 15\n\n  const endYear = endTime.getFullYear();\n  const endMonth = String(endTime.getMonth() + 1).padStart(2, '0');\n  const endDay = String(endTime.getDate()).padStart(2, '0');\n  const endHour = String(endTime.getHours()).padStart(2, '0');\n  const endMinute = String(endTime.getMinutes()).padStart(2, '0');\n\n  data.. = {\n    : true,\n    : `${currentDate} ${currentTime}`,\n    : `${endYear}/${endMonth}/${endDay} ${endHour}:${endMinute}`,\n    : HOSPITALIZATION_DAYS,\n    : currentFloor,\n  };\n\n  // 15\n  const freezeEndTime = `${endYear}/${endMonth}/${endDay} ${endHour}:${endMinute}`;\n  data.. = {\n    : true,\n    : '',\n    : `${currentDate} ${currentTime}`,\n    : freezeEndTime,\n  };\n  data.. = {\n    : true,\n    : '',\n    : `${currentDate} ${currentTime}`,\n    : freezeEndTime,\n  };\n\n  console.info(`[+] + ${data...} `);\n  console.info(`[+] 15/`);\n  return true;\n}\n\n/**\n * \n * @param data \n * @param currentDate \n * @param currentTime \n * @returns \n */\nfunction updateHospitalizationState(data: SchemaType, currentDate: string, currentTime: string): boolean {\n  const hospState = data..;\n  if (!hospState?.) return false;\n\n  const endTimeStr = hospState.;\n  if (!endTimeStr || !endTimeStr.includes(' ')) return false;\n\n  const [endDatePart, endTimePart] = endTimeStr.split(' ');\n  if (!endDatePart || !endTimePart) return false;\n\n  const endTime = parseTime(endTimePart, endDatePart);\n  const currentTimeObj = parseTime(currentTime, currentDate);\n\n  if (currentTimeObj >= endTime) {\n    // \n    data.. = {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : -1,\n    };\n    console.info('[+] ');\n    return false;\n  }\n\n  // \n  const remainingMs = endTime.getTime() - currentTimeObj.getTime();\n  const remainingDays = Math.ceil(remainingMs / (1000 * 60 * 60 * 24));\n  data... = remainingDays;\n\n  return true;\n}\n\n/**\n * \n * @param lastUseTime \n * @param currentDate \n * @param currentTime \n * @returns \n */\nfunction isSleepingPillCooldownOver(lastUseTime: string, currentDate: string, currentTime: string): boolean {\n  if (!lastUseTime || !lastUseTime.includes(' ')) return true;\n\n  const [lastDatePart, lastTimePart] = lastUseTime.split(' ');\n  if (!lastDatePart || !lastTimePart) return true;\n\n  const lastTime = parseTime(lastTimePart, lastDatePart);\n  const current = parseTime(currentTime, currentDate);\n  const hoursDiff = (current.getTime() - lastTime.getTime()) / (1000 * 60 * 60);\n\n  return hoursDiff >= SLEEPING_PILL_COOLDOWN_HOURS;\n}\n\n/**\n * \n * @param data \n * @param currentDate \n * @param currentTime \n * @param currentFloor IDROLL\n * @returns false\n */\nfunction activateSleepingPill(data: SchemaType, currentDate: string, currentTime: string, currentFloor: number): boolean {\n  const pillState = data..;\n  const lastUseTime = pillState.;\n  const lastTriggerFloor = pillState. ?? -1;\n\n  // ROLLtrue\n  if (lastTriggerFloor === currentFloor && pillState.) {\n    console.info(`[] ROLL${currentFloor}`);\n    return true;\n  }\n\n  // ROLL\n  const isRollTrigger = lastTriggerFloor === currentFloor;\n  if (!isRollTrigger) {\n    // ROLL\n    if (!isSleepingPillCooldownOver(lastUseTime, currentDate, currentTime)) {\n      console.warn('[] 48');\n      return false;\n    }\n  } else {\n    console.info(`[] ROLL${currentFloor}`);\n  }\n\n  const startTime = parseTime(currentTime, currentDate);\n  const endTime = new Date(startTime.getTime());\n  endTime.setHours(endTime.getHours() + 6); // 6\n\n  const endYear = endTime.getFullYear();\n  const endMonth = String(endTime.getMonth() + 1).padStart(2, '0');\n  const endDay = String(endTime.getDate()).padStart(2, '0');\n  const endHour = String(endTime.getHours()).padStart(2, '0');\n  const endMinute = String(endTime.getMinutes()).padStart(2, '0');\n\n  data.. = {\n    : true,\n    : `${currentDate} ${currentTime}`,\n    : `${endYear}/${endMonth}/${endDay} ${endHour}:${endMinute}`,\n    : 6,\n    : `${currentDate} ${currentTime}`,\n    : currentFloor,\n  };\n\n  console.info(`[]  ${data...} `);\n  return true;\n}\n\n/**\n * \n * @param data \n * @param currentDate \n * @param currentTime \n * @returns \n */\nfunction updateSleepingPillState(data: SchemaType, currentDate: string, currentTime: string): boolean {\n  const pillState = data..;\n  if (!pillState.) return false;\n\n  const endTimeStr = pillState.;\n  if (!endTimeStr || !endTimeStr.includes(' ')) return false;\n\n  const [endDatePart, endTimePart] = endTimeStr.split(' ');\n  if (!endDatePart || !endTimePart) return false;\n\n  const endTime = parseTime(endTimePart, endDatePart);\n  const currentTimeObj = parseTime(currentTime, currentDate);\n\n  if (currentTimeObj >= endTime) {\n    // \n    const lastUseTime = pillState.;\n    data.. = {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : lastUseTime,\n      : -1, // \n    };\n    console.info('[] ');\n    return false;\n  }\n\n  // \n  const remainingMs = endTime.getTime() - currentTimeObj.getTime();\n  const remainingHours = Math.ceil(remainingMs / (1000 * 60 * 60));\n  data... = remainingHours;\n\n  return true;\n}\n\n// ==========  ==========\nfunction updateSuwenSchedule(data: SchemaType, dateStr: string, timeStr: string): void {\n  const [hour, minute] = timeStr.split(':').map(Number);\n  const timeInMinutes = hour * 60 + minute;\n  const [year, month, day] = dateStr.split('/').map(Number);\n  const date = new Date(year, month - 1, day);\n  const dayOfWeek = date.getDay();\n  const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;\n\n  let newStatus: '' | '' | '' | '' = '';\n  let newLocation: '' | '' | '' | '' | '' | '' | '' = '';\n\n  if (isWeekend) {\n    if (timeInMinutes >= 23 * 60 || timeInMinutes < 7 * 60) {\n      newStatus = '';\n      newLocation = '';\n    } else if (timeInMinutes >= 7 * 60 && timeInMinutes < 8 * 60) {\n      newStatus = '';\n      newLocation = '';\n    } else if (timeInMinutes >= 8 * 60 && timeInMinutes < 9 * 60) {\n      newStatus = '';\n      newLocation = Math.random() < 0.5 ? '' : '';\n    } else if (timeInMinutes >= 9 * 60 && timeInMinutes < 12 * 60) {\n      newStatus = '';\n      newLocation = '';\n    } else if (timeInMinutes >= 12 * 60 && timeInMinutes < 13 * 60) {\n      newStatus = '';\n      newLocation = Math.random() < 0.5 ? '' : '';\n    } else if (timeInMinutes >= 13 * 60 && timeInMinutes < 18 * 60) {\n      newStatus = '';\n      newLocation = Math.random() < 0.3 ? '' : '';\n    } else if (timeInMinutes >= 18 * 60 && timeInMinutes < 19 * 60) {\n      newStatus = '';\n      newLocation = Math.random() < 0.5 ? '' : '';\n    } else if (timeInMinutes >= 19 * 60 && timeInMinutes < 22 * 60) {\n      newStatus = '';\n      newLocation = '';\n    } else if (timeInMinutes >= 22 * 60 && timeInMinutes < 23 * 60) {\n      newStatus = '';\n      newLocation = Math.random() < 0.5 ? '' : '';\n    }\n  } else {\n    // \n    //  (8:00-12:00)\n    //  (13:00-18:00)\n    const isMorningShift = dayOfWeek === 1 || dayOfWeek === 3 || dayOfWeek === 5;\n\n    if (timeInMinutes >= 23 * 60 || timeInMinutes < 6 * 60) {\n      newStatus = '';\n      newLocation = '';\n    } else if (timeInMinutes >= 6 * 60 && timeInMinutes < 7 * 60) {\n      newStatus = '';\n      newLocation = '';\n    } else if (timeInMinutes >= 7 * 60 && timeInMinutes < 8 * 60) {\n      newStatus = '';\n      newLocation = Math.random() < 0.5 ? '' : '';\n    } else if (isMorningShift) {\n      // 8:00-12:00 \n      if (timeInMinutes >= 8 * 60 && timeInMinutes < 12 * 60) {\n        newStatus = '';\n        newLocation = '';\n      } else if (timeInMinutes >= 12 * 60 && timeInMinutes < 13 * 60) {\n        newStatus = '';\n        newLocation = Math.random() < 0.5 ? '' : '';\n      } else if (timeInMinutes >= 13 * 60 && timeInMinutes < 18 * 60) {\n        newStatus = '';\n        newLocation = '';\n      } else if (timeInMinutes >= 18 * 60 && timeInMinutes < 19 * 60) {\n        newStatus = '';\n        newLocation = Math.random() < 0.5 ? '' : '';\n      } else if (timeInMinutes >= 19 * 60 && timeInMinutes < 22 * 60) {\n        newStatus = '';\n        newLocation = '';\n      } else if (timeInMinutes >= 22 * 60 && timeInMinutes < 23 * 60) {\n        newStatus = '';\n        newLocation = Math.random() < 0.5 ? '' : '';\n      }\n    } else {\n      // 13:00-18:00 \n      if (timeInMinutes >= 8 * 60 && timeInMinutes < 12 * 60) {\n        newStatus = '';\n        newLocation = '';\n      } else if (timeInMinutes >= 12 * 60 && timeInMinutes < 13 * 60) {\n        newStatus = '';\n        newLocation = Math.random() < 0.5 ? '' : '';\n      } else if (timeInMinutes >= 13 * 60 && timeInMinutes < 18 * 60) {\n        newStatus = '';\n        newLocation = '';\n      } else if (timeInMinutes >= 18 * 60 && timeInMinutes < 19 * 60) {\n        newStatus = '';\n        newLocation = Math.random() < 0.5 ? '' : '';\n      } else if (timeInMinutes >= 19 * 60 && timeInMinutes < 22 * 60) {\n        newStatus = '';\n        newLocation = '';\n      } else if (timeInMinutes >= 22 * 60 && timeInMinutes < 23 * 60) {\n        newStatus = '';\n        newLocation = Math.random() < 0.5 ? '' : '';\n      }\n    }\n  }\n\n  const patrolActive = data.?.?.;\n  if (patrolActive) {\n    if (data.. !== newStatus) {\n      data.. = newStatus;\n    }\n    return;\n  }\n\n  if (data.. !== newStatus || data.. !== newLocation) {\n    data.. = newStatus;\n    data.. = newLocation;\n  }\n}\n\n// ==========  ==========\nconst PATROL_CONFIG = {\n  baseProbability: 0.15,\n  timeModifiers: {\n    morning: { start: 7, end: 12, modifier: 1.0 },\n    afternoon: { start: 12, end: 18, modifier: 1.2 },\n    evening: { start: 18, end: 22, modifier: 0.8 },\n    night: { start: 22, end: 7, modifier: 0.3 },\n  },\n  suspicionModifiers: [\n    { min: 0, max: 20, modifier: 0.8 },\n    { min: 20, max: 40, modifier: 1.0 },\n    { min: 40, max: 60, modifier: 1.3 },\n    { min: 60, max: 80, modifier: 1.6 },\n    { min: 80, max: 100, modifier: 2.0 },\n  ],\n  cooldownHours: 2,\n};\n\nfunction getTimeModifier(hour: number): number {\n  const { timeModifiers } = PATROL_CONFIG;\n  if (hour >= timeModifiers.morning.start && hour < timeModifiers.morning.end) return timeModifiers.morning.modifier;\n  if (hour >= timeModifiers.afternoon.start && hour < timeModifiers.afternoon.end) return timeModifiers.afternoon.modifier;\n  if (hour >= timeModifiers.evening.start && hour < timeModifiers.evening.end) return timeModifiers.evening.modifier;\n  return timeModifiers.night.modifier;\n}\n\nfunction getSuspicionModifier(suspicion: number): number {\n  for (const range of PATROL_CONFIG.suspicionModifiers) {\n    if (suspicion >= range.min && suspicion < range.max) return range.modifier;\n  }\n  return 1.0;\n}\n\nfunction calculatePatrolProbability(hour: number, suspicion: number): number {\n  const probability = PATROL_CONFIG.baseProbability * getTimeModifier(hour) * getSuspicionModifier(suspicion);\n  return Math.min(0.8, Math.max(0, probability));\n}\n\nfunction isPatrolCooldownOver(lastPatrolTime: string, currentDate: string, currentTime: string): boolean {\n  if (!lastPatrolTime || !lastPatrolTime.includes(' ')) return true;\n  const [lastDatePart, lastTimePart] = lastPatrolTime.split(' ');\n  if (!lastDatePart || !lastTimePart) return true;\n  const lastTime = parseTime(lastTimePart, lastDatePart);\n  const current = parseTime(currentTime, currentDate);\n  const hoursDiff = (current.getTime() - lastTime.getTime()) / (1000 * 60 * 60);\n  return hoursDiff >= PATROL_CONFIG.cooldownHours;\n}\n\n/**\n * \n *\n * \n * 1.  = \n * 2. \n * 3. / < 2 \n */\nfunction shouldIncreaseSuspicion(\n  suwenState: SchemaType[''],\n  characterLocation: string,\n  suwenLocation: string,\n  currentCharacter: '' | '',\n): boolean {\n  const freezeField = currentCharacter === '' ? '' : '';\n\n  // 1. \n  if (suwenState[freezeField].) return false;\n\n  // 2. \n  if (suwenState. === '') return false;\n\n  // 3. /\n  if (suwenState. === '' || suwenState. === '') return false;\n\n  // 4. \n  if (suwenLocation === '') return false;\n\n  // 5. \n  if (characterLocation !== '' && characterLocation !== '' && characterLocation) {\n    return false;\n  }\n\n  // 6. \n  if (isSameSpace(characterLocation || '', suwenLocation)) return false;\n\n  return true;\n}\n\nfunction extractKeywords(thoughtContent: string): string[] {\n  const keywords: string[] = [thoughtContent];\n  const segments = thoughtContent.split(/[\\s]+/).filter(s => s.length >= 2);\n  keywords.push(...segments);\n  for (let len = 2; len <= Math.min(4, thoughtContent.length); len++) {\n    for (let i = 0; i <= thoughtContent.length - len; i++) {\n      const word = thoughtContent.slice(i, i + len);\n      if (!/^[\\s]+$/.test(word)) keywords.push(word);\n    }\n  }\n  return [...new Set(keywords)];\n}\n\nfunction checkThoughtRelevance(thoughtContent: string, userMessage: string, aiMessage: string): number {\n  const keywords = extractKeywords(thoughtContent);\n  const combinedText = `${userMessage} ${aiMessage}`.toLowerCase();\n  let matchCount = 0;\n  let exactMatch = false;\n  for (const keyword of keywords) {\n    if (combinedText.includes(keyword.toLowerCase())) {\n      matchCount++;\n      if (keyword === thoughtContent) exactMatch = true;\n    }\n  }\n  if (exactMatch || matchCount >= 5) return 3;\n  if (matchCount >= 3) return 2;\n  if (matchCount >= 1) return 1;\n  return 0;\n}\n\n// ==========  ==========\n/**\n * \n * @param data \n * @returns \n */\nexport function isSleepingPillEffective(data: SchemaType): boolean {\n  return data..?. === true;\n}\n\n/**\n * \n * @param data \n * @returns 0\n */\nexport function getSleepingPillRemainingHours(data: SchemaType): number {\n  if (!isSleepingPillEffective(data)) return 0;\n  return data... || 0;\n}\n\n/**\n * \n * @param data \n * @param currentDate \n * @param currentTime \n * @returns \n */\nexport function canUseSleepingPill(data: SchemaType, currentDate: string, currentTime: string): boolean {\n  const lastUseTime = data..?. || '';\n  return isSleepingPillCooldownOver(lastUseTime, currentDate, currentTime);\n}\n\n// ==========  ==========\n/**\n * +\n * @param data \n * @returns \n */\nexport function isHospitalized(data: SchemaType): boolean {\n  return data..?. === true;\n}\n\n/**\n * \n * @param data \n * @returns 0\n */\nexport function getHospitalizationRemainingDays(data: SchemaType): number {\n  if (!isHospitalized(data)) return 0;\n  return data... || 0;\n}\n\n/**\n * \n * @param data \n * @returns \n */\nexport function getHospitalizationEndTime(data: SchemaType): string {\n  if (!isHospitalized(data)) return '';\n  return data... || '';\n}\n\n// ==========  ==========\nexport interface TimeAdvanceResult {\n  oldTime: string;\n  oldDate: string;\n  newTime: string;\n  newDate: string;\n}\n\n/**\n * \n * @param data \n * @param userText \n * @param aiText AI\n * @returns \n */\nexport function advanceTime(data: SchemaType, userText: string, aiText: string): TimeAdvanceResult | null {\n  const oldDate = data.?.;\n  const oldTime = data.?.;\n\n  if (!oldTime || !oldDate || !oldTime.includes(':') || !oldDate.includes('/')) {\n    console.error('[] !', { : oldTime, : oldDate });\n    return null;\n  }\n\n  // =====  =====\n  const [hours, minutes] = oldTime.split(':').map(Number);\n  const [year, month, day] = oldDate.split('/').map(Number);\n\n  if (isNaN(hours) || isNaN(minutes) || isNaN(year) || isNaN(month) || isNaN(day)) {\n    console.error('[] !', { hours, minutes, year, month, day });\n    return null;\n  }\n\n  // =====  =====\n  const jumpHours = detectTimeJump(userText, hours);\n  const hoursToAdvance = jumpHours > 0 ? jumpHours : 1; // +1\n  const isTimeJump = jumpHours > 1; // 1\n\n  if (jumpHours > 0) {\n    console.info(`[]  ${hoursToAdvance} `);\n  }\n\n  const currentDate = new Date(year, month - 1, day, hours, minutes);\n  currentDate.setHours(currentDate.getHours() + hoursToAdvance);\n\n  const newHours = String(currentDate.getHours()).padStart(2, '0');\n  const newMinutes = String(currentDate.getMinutes()).padStart(2, '0');\n  const newTime = `${newHours}:${newMinutes}`;\n  const newYear = currentDate.getFullYear();\n  const newMonth = String(currentDate.getMonth() + 1).padStart(2, '0');\n  const newDay = String(currentDate.getDate()).padStart(2, '0');\n  const newDate = `${newYear}/${newMonth}/${newDay}`;\n\n  // =====  =====\n  const weekDays = ['', '', '', '', '', '', ''] as const;\n  const newWeekDay = weekDays[currentDate.getDay()];\n\n  // =====  =====\n  data.. = newTime;\n  data.. = newDate;\n  data.. = newWeekDay;\n  (data as any)._ = `${oldDate} ${oldTime}`;\n\n  // =====  =====\n  const tracking = data.;\n\n  //  . AI  MVU  AI \n  const worldLocation = data.?. || '';\n  const isInSonRoom = worldLocation.includes('');\n  const currentLocationFromWorld = isInSonRoom ? '' : (worldLocation.split(' - ').pop() || '');\n\n  const oldLocation = tracking.;\n  if (oldLocation !== currentLocationFromWorld) {\n    tracking. = currentLocationFromWorld;\n    tracking. = `${newDate} ${newTime}`;\n    console.info(`[] : ${oldLocation}  ${currentLocationFromWorld}`);\n\n    // AI\n    if (oldLocation === '' && !isInSonRoom) {\n      // \n      if (tracking.?. && tracking.?.AI) {\n        console.info('[] AI');\n        tracking.. = false;\n        tracking..AI = false;\n        tracking.. = '';\n        tracking.. = 0;\n      } else if (tracking.?.) {\n        console.info('[] AI');\n      }\n    }\n  }\n  tracking. = `${newDate} ${newTime}`;\n\n  // =====  =====\n  updateSuwenSchedule(data, newDate, newTime);\n\n  // ===== + =====\n  const combinedText = `${userText} ${aiText}`;\n  const currentFloor = getLastMessageId();\n\n  if (detectHospitalization(combinedText)) {\n    // ROLL\n    activateHospitalization(data, newDate, newTime, currentFloor);\n  }\n\n  // \n  const isHospitalized = updateHospitalizationState(data, newDate, newTime);\n\n  // \n  if (isHospitalized) {\n    data.. = '';\n    data.. = '';\n    console.info(`[+]  ${data...} `);\n  }\n\n  // =====  =====\n  // /AI\n  if (!isHospitalized && detectSleepingPill(combinedText)) {\n    // ROLL\n    activateSleepingPill(data, newDate, newTime, currentFloor);\n  }\n\n  // \n  const isSleepingPillActive = !isHospitalized && updateSleepingPillState(data, newDate, newTime);\n\n  // \n  if (isSleepingPillActive) {\n    data.. = '';\n    data.. = '';\n    console.info(`[]  ${data...} `);\n  }\n\n  // =====  =====\n  const currentLocation = tracking.;\n  const currentCharacter = tracking. || '';\n  const suwenLocation = data.. || '';\n  const suwenStatus = data..;\n\n  console.info(`[] : ${oldDate} ${oldTime}  ${newDate} ${newTime}`);\n  console.info(`[] =\"${currentCharacter}\", =\"${currentLocation}\", =\"${suwenLocation}\", =\"${suwenStatus}\"`);\n\n  // \n  if (tracking. === undefined) {\n    tracking. = currentCharacter === '' ? (tracking. || 0) : 0;\n  }\n  if (tracking. === undefined) {\n    tracking. = currentCharacter === '' ? (tracking. || 0) : 0;\n  }\n\n  // \n  const isInDanger =\n    currentLocation === '' &&\n    shouldIncreaseSuspicion(data., currentLocation, suwenLocation, currentCharacter);\n\n  // \n  const dangerTimeField = currentCharacter === '' ? '' : '';\n  const currentDangerTime = tracking[dangerTimeField] || 0;\n\n  console.info(`[] ${currentCharacter}: isInDanger=${isInDanger}, =${currentDangerTime}`);\n\n  if (isInDanger) {\n    //  +1\n    tracking[dangerTimeField] = currentDangerTime + 1;\n    console.info(`[] ${currentCharacter}  +1 =${tracking[dangerTimeField]}`);\n\n    //  2-3  +5\n    if (tracking[dangerTimeField] >= 2 && tracking[dangerTimeField] < 4) {\n      const suspicionField = currentCharacter === '' ? '' : '';\n      data.[suspicionField] += 5;\n      console.info(`[] ${currentCharacter}  ${tracking[dangerTimeField]}  +5`);\n    }\n\n    //  4+  +10\n    if (tracking[dangerTimeField] >= 4) {\n      const suspicionField = currentCharacter === '' ? '' : '';\n      data.[suspicionField] += 10;\n      tracking. = {\n        : true,\n        AI: false,\n        : `${currentCharacter}4`,\n        : tracking[dangerTimeField],\n        : false,\n        : '',\n      };\n      console.info(`[] ${currentCharacter}  ${tracking[dangerTimeField]}  +10`);\n\n      // ROLL\n      const currentFloor = getLastMessageId();\n      tracking. = tracking. || [];\n      tracking..push({\n        : '',\n        : currentCharacter,\n        : currentFloor,\n        : `${newDate} ${newTime}`,\n        AI: false,\n        : tracking[dangerTimeField],\n        : `${currentCharacter}4`,\n      });\n      console.info(`[] : ${currentCharacter}, ${currentFloor}`);\n\n      tracking[dangerTimeField] = 0;\n    }\n  } else {\n    // \n    if (currentDangerTime > 0) {\n      // /\n      const isWindowClosed =\n        data.. === '' ||\n        data.. === '' ||\n        data.. === '' ||\n        suwenLocation === '';\n\n      if (isWindowClosed) {\n        //  < 2 \n        if (currentDangerTime < 2) {\n          console.warn(\n            `[] ${currentCharacter} =\"${data..}\"2${currentDangerTime}h`\n          );\n          tracking[dangerTimeField] = 0;\n        } else {\n          // \n          console.info(\n            `[] ${currentCharacter} =\"${data..}\"${currentDangerTime}h`\n          );\n          tracking[dangerTimeField] = 0;\n        }\n      } else {\n        // \n        console.info(\n          `[] ${currentCharacter} =\"${currentLocation}\"${currentDangerTime}h`\n        );\n      }\n    }\n\n    // \n    //  AI \n    //       \n  }\n\n  // =====  =====\n  const lastDecayDate = tracking. || newDate;\n  if (lastDecayDate !== newDate) {\n    const [lastYear, lastMonth, lastDay] = lastDecayDate.split('/').map(Number);\n    const [curYear, curMonth, curDay] = newDate.split('/').map(Number);\n    const lastDateObj = new Date(lastYear, lastMonth - 1, lastDay);\n    const currentDateObj = new Date(curYear, curMonth - 1, curDay);\n    const daysPassed = Math.floor((currentDateObj.getTime() - lastDateObj.getTime()) / (1000 * 60 * 60 * 24));\n    if (daysPassed > 0) {\n      const totalDecay = daysPassed * 2;\n      (['', ''] as const).forEach(suspicionField => {\n        const oldValue = data.[suspicionField];\n        data.[suspicionField] = Math.max(0, oldValue - totalDecay);\n      });\n      tracking. = newDate;\n    }\n  }\n\n  // \n  if (!isInDanger && isSameSpace(currentLocation, suwenLocation) && data.. === '') {\n    const suspicionField = currentCharacter === '' ? '' : '';\n    const freezeField = currentCharacter === '' ? '' : '';\n    if (!data.[freezeField]. && data.[suspicionField] > 0) {\n      data.[suspicionField] = Math.max(0, data.[suspicionField] - 1);\n    }\n  }\n\n  // =====  =====\n  (['', ''] as const).forEach(characterKey => {\n    const character = data[characterKey];\n    if (!character) return;\n    character..forEach((thought) => {\n      // 1\n      // \n      if (isTimeJump) {\n        const oldProgress = thought.;\n        thought. += 1; // 1\n\n        //  =  + 12\n        // \n        const newDateObj = parseTime(newTime, newDate);\n        newDateObj.setHours(newDateObj.getHours() + 12); // 12\n        const extendedYear = newDateObj.getFullYear();\n        const extendedMonth = String(newDateObj.getMonth() + 1).padStart(2, '0');\n        const extendedDay = String(newDateObj.getDate()).padStart(2, '0');\n        const extendedHour = String(newDateObj.getHours()).padStart(2, '0');\n        const extendedMinute = String(newDateObj.getMinutes()).padStart(2, '0');\n        thought. = `${extendedYear}/${extendedMonth}/${extendedDay} ${extendedHour}:${extendedMinute}`;\n\n        console.info(\n          `[]  ${characterKey}: \"${thought.}\" ` +\n          ` ${oldProgress}  ${thought.},  ${thought.}`\n        );\n      } else {\n        // \n        const relevance = checkThoughtRelevance(thought., userText, aiText);\n        const progressGain = [0, 0.5, 1, 1.5][relevance];\n        if (progressGain > 0) thought. += progressGain;\n      }\n    });\n  });\n\n  // =====  =====\n  const patrolEvent = tracking.;\n  const freezeField = currentCharacter === '' ? '' : '';\n  if (\n    isInDanger &&\n    !patrolEvent. &&\n    !data.[freezeField]. &&\n    isPatrolCooldownOver(patrolEvent., newDate, newTime)\n  ) {\n    const suspicionField = currentCharacter === '' ? '' : '';\n    const patrolProbability = calculatePatrolProbability(parseInt(newHours), data.[suspicionField]);\n    const roll = Math.random();\n    if (roll < patrolProbability) {\n      // 1-2\n      const deadlineHours = 1 + Math.floor(Math.random() * 2); // 1  2 \n      const deadlineTime = parseTime(newTime, newDate);\n      deadlineTime.setHours(deadlineTime.getHours() + deadlineHours);\n      const deadlineHH = String(deadlineTime.getHours()).padStart(2, '0');\n      const deadlineMM = String(deadlineTime.getMinutes()).padStart(2, '0');\n\n      tracking. = {\n        : true,\n        AI: false,\n        : `${newDate} ${newTime}`,\n        : '',\n        : `${newDate} ${newTime}`,\n        : `${deadlineHH}:${deadlineMM}`,\n        : deadlineHours,\n      };\n\n      // ROLL\n      const currentFloor = getLastMessageId();\n      tracking. = tracking. || [];\n      tracking..push({\n        : '',\n        : currentCharacter,\n        : currentFloor,\n        : `${newDate} ${newTime}`,\n        AI: false,\n      });\n      console.info(`[] : ${currentCharacter}, ${currentFloor}`);\n\n      // \n      tracking[dangerTimeField] = 0;\n    }\n  }\n\n  // \n  if (patrolEvent. && patrolEvent.AI && patrolEvent.) {\n    // \n    let patrolCharacter: '' | '' = currentCharacter;\n    const patrolLog = tracking.?.find(\n      (log: any) => log. === '' && log.AI\n    );\n    if (patrolLog) {\n      patrolCharacter = patrolLog. as '' | '';\n      console.info(`[] : ${patrolCharacter}`);\n    } else {\n      console.warn(`[] : ${currentCharacter}`);\n    }\n\n    // \n    const patrolCharacterLocation = tracking. === patrolCharacter ? tracking. : '';\n    const hasLeft = patrolCharacterLocation !== '';\n\n    if (hasLeft) {\n      // \n      console.info(`[] ${patrolCharacter}`);\n      tracking.. = false;\n      tracking..AI = false;\n      tracking.. = '';\n      tracking.. = 0;\n    } else {\n      // \n      const [deadlineHH, deadlineMM] = patrolEvent..split(':').map(Number);\n      const currentTimeObj = parseTime(newTime, newDate);\n      const deadlineTimeObj = parseTime(newTime, newDate);\n      deadlineTimeObj.setHours(deadlineHH, deadlineMM, 0, 0);\n\n      // \n      const triggerTimeParts = patrolEvent..split(' ')[1]?.split(':');\n      if (triggerTimeParts) {\n        const triggerHH = parseInt(triggerTimeParts[0]);\n        if (deadlineHH < triggerHH) {\n          deadlineTimeObj.setDate(deadlineTimeObj.getDate() + 1);\n        }\n      }\n\n      if (currentTimeObj >= deadlineTimeObj) {\n        // \n        console.info(`[] ${patrolCharacter}${patrolEvent.}`);\n        const suspicionField = patrolCharacter === '' ? '' : '';\n        data.[suspicionField] += 10;\n\n        // \n        tracking. = {\n          : true,\n          AI: false,\n          : `${patrolCharacter}`,\n          : patrolEvent.,\n          : false,\n          : '',\n        };\n\n        // \n        const currentFloor = getLastMessageId();\n        tracking. = tracking. || [];\n        tracking..push({\n          : '',\n          : patrolCharacter,\n          : currentFloor,\n          : `${newDate} ${newTime}`,\n          AI: false,\n          : patrolEvent.,\n          : `${patrolCharacter}`,\n        });\n\n        // \n        tracking.. = false;\n        tracking..AI = false;\n        tracking.. = '';\n        tracking.. = 0;\n      } else {\n        console.info(`[] ${patrolCharacter}${patrolEvent.}`);\n      }\n    }\n  }\n\n  // =====  =====\n  //  AI /\n  const interruptionEvent = tracking.;\n  if (interruptionEvent. && interruptionEvent.AI && interruptionEvent. !== '') {\n    // \n    let interruptionCharacter: '' | '' = currentCharacter;\n    const interruptionLog = tracking.?.find(\n      (log: any) => log. === '' && log.AI\n    );\n    if (interruptionLog) {\n      interruptionCharacter = interruptionLog. as '' | '';\n      console.info(`[] : ${interruptionCharacter}`);\n    }\n\n    const suspicionField = interruptionCharacter === '' ? '' : '';\n    const freezeField = interruptionCharacter === '' ? '' : '';\n\n    if (interruptionEvent. === '') {\n      // \n      // 2\n      const freezeHours = 2;\n      const freezeEndTime = parseTime(newTime, newDate);\n      freezeEndTime.setHours(freezeEndTime.getHours() + freezeHours);\n      const freezeEndYear = freezeEndTime.getFullYear();\n      const freezeEndMonth = String(freezeEndTime.getMonth() + 1).padStart(2, '0');\n      const freezeEndDay = String(freezeEndTime.getDate()).padStart(2, '0');\n      const freezeEndHour = String(freezeEndTime.getHours()).padStart(2, '0');\n      const freezeEndMinute = String(freezeEndTime.getMinutes()).padStart(2, '0');\n\n      data.[freezeField] = {\n        : true,\n        : interruptionEvent. || '',\n        : `${newDate} ${newTime}`,\n        : `${freezeEndYear}/${freezeEndMonth}/${freezeEndDay} ${freezeEndHour}:${freezeEndMinute}`,\n      };\n      console.info(`[]  ${data.[freezeField].}`);\n    } else if (interruptionEvent. === '') {\n      // +10+10+20\n      data.[suspicionField] += 10;\n      console.info(`[] +10+20${interruptionCharacter}`);\n    }\n\n    // \n    tracking. = {\n      : false,\n      AI: false,\n      : '',\n      : 0,\n      : false,\n      : '',\n    };\n    console.info(`[] : ${interruptionEvent.}`);\n  }\n\n  // =====  =====\n  (['', ''] as const).forEach(freezeFieldName => {\n    const characterName = freezeFieldName === '' ? '' : '';\n    const suspicionField = freezeFieldName === '' ? '' : '';\n    if (data.[freezeFieldName].) {\n      const freezeEndTimeStr = data.[freezeFieldName].;\n      if (freezeEndTimeStr && freezeEndTimeStr.includes(' ')) {\n        const [freezeDatePart, freezeTimePart] = freezeEndTimeStr.split(' ');\n        if (freezeDatePart && freezeTimePart) {\n          const freezeEndTime = parseTime(freezeTimePart, freezeDatePart);\n          const currentTimeObj = parseTime(newTime, newDate);\n          if (currentTimeObj >= freezeEndTime) {\n            if (tracking. === characterName && tracking. === '') {\n              data.[suspicionField] += 8;\n            }\n            data.[freezeFieldName]. = false;\n            data.[freezeFieldName]. = '';\n            data.[freezeFieldName]. = '';\n            data.[freezeFieldName]. = '';\n          }\n        }\n      }\n    }\n  });\n\n  return { oldTime, oldDate, newTime, newDate };\n}\n","/**\n * 5\n *\n * 155\n * - \n * - \n * - \n */\n\n// ============================================\n// \n// ============================================\n\nexport const EXPOSURE_LEVELS = ['', '', '', '', ''] as const;\nexport const MAKEUP_LEVELS = ['', '', '', '', ''] as const;\nexport const TIDINESS_LEVELS = ['', '', '', '', ''] as const;\n\nexport type ExposureLevel = (typeof EXPOSURE_LEVELS)[number];\nexport type MakeupLevel = (typeof MAKEUP_LEVELS)[number];\nexport type TidinessLevel = (typeof TIDINESS_LEVELS)[number];\n\n/**  */\nexport function getExposureIndex(level: ExposureLevel): number {\n  return EXPOSURE_LEVELS.indexOf(level);\n}\n\n/**  */\nexport function getMakeupIndex(level: MakeupLevel): number {\n  return MAKEUP_LEVELS.indexOf(level);\n}\n\n/**  */\nexport function getTidinessIndex(level: TidinessLevel): number {\n  return TIDINESS_LEVELS.indexOf(level);\n}\n\n// ============================================\n// 5\n// ============================================\n\nexport const STAGE_TITLES = ['', '', '', '', ''] as const;\nexport type StageTitle = (typeof STAGE_TITLES)[number];\n\n// ============================================\n// \n// ============================================\n\nexport interface StageConfig {\n  : number;\n  : StageTitle;\n  : [number, number];\n\n  // \n  : {\n    : ExposureLevel;\n    : [ExposureLevel, ExposureLevel];\n    : MakeupLevel;\n    : [MakeupLevel, MakeupLevel];\n    : boolean;\n    : boolean;\n  };\n\n  // \n  : {\n    : {\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : ExposureLevel;\n      : TidinessLevel;\n    };\n    : {\n      : string;\n      : string;\n      : string;\n      : string;\n      : string;\n      : MakeupLevel;\n      : string;\n    };\n    : string;\n  };\n\n  // 4-5\n  ?: {\n    : string[];\n    : string[];\n    : string[];\n  };\n\n  // \n  : number;\n}\n\n// ============================================\n// \n// ============================================\n\nexport interface StageStoryConfig {\n  : number;\n  : {\n    : string;\n    : string;\n    : string;\n  };\n  : {\n    : string;\n    : string;\n    : string;\n  };\n}\n\n// ============================================\n// 5\n// ============================================\n\nexport const STAGE_CONFIG: StageConfig[] = [\n  // ===============================================\n  // 1:  ( 0-19)\n  // +54\n  // ===============================================\n  {\n    : 1,\n    : '',\n    : [0, 19],\n    : {\n      : '',\n      : ['', ''],\n      : '',\n      : ['', ''],\n      : false,\n      : false,\n    },\n    : {\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : '',\n    },\n    : 1.2,\n  },\n\n  // ===============================================\n  // 2:  ( 20-39)\n  // ===============================================\n  {\n    : 2,\n    : '',\n    : [20, 39],\n    : {\n      : '',\n      : ['', ''],\n      : '',\n      : ['', ''],\n      : false,\n      : false,\n    },\n    : {\n      : {\n        : '',\n        : 'V',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : '',\n    },\n    : 1.0,\n  },\n\n  // ===============================================\n  // 3:  ( 40-59)\n  // ===============================================\n  {\n    : 3,\n    : '',\n    : [40, 59],\n    : {\n      : '',\n      : ['', ''],\n      : '',\n      : ['', ''],\n      : true,\n      : false,\n    },\n    : {\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : 'T',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : '',\n    },\n    : 0.8,\n  },\n\n  // ===============================================\n  // 4:  ( 60-79)\n  // ===============================================\n  {\n    : 4,\n    : '',\n    : [60, 79],\n    : {\n      : '',\n      : ['', ''],\n      : '',\n      : ['', ''],\n      : true,\n      : true,\n    },\n    : {\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : '',\n    },\n    : {\n      : ['', '', '', ''],\n      : ['', '', ''],\n      : ['', ''],\n    },\n    : 0.6,\n  },\n\n  // ===============================================\n  // 5:  ( 80+)\n  // 1616\n  // ===============================================\n  {\n    : 5,\n    : '',\n    : [80, 999],\n    : {\n      : '',\n      : ['', ''],\n      : '',\n      : ['', ''],\n      : true,\n      : true,\n    },\n    : {\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : {\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n        : '',\n      },\n      : '',\n    },\n    : {\n      : ['', '', ''],\n      : ['', ''],\n      : ['', '', ''],\n    },\n    : 0.5,\n  },\n];\n\n// ============================================\n// 5\n// ============================================\n\nexport const STAGE_STORY_CONFIG: StageStoryConfig[] = [\n  // ===============================================\n  // 1:  - \n  // ===============================================\n  {\n    : 1,\n    : {\n      : '',\n      : '',\n      : `42\n\n\n1. \n2. {{user}}\n3. \n4. \n\n`,\n    },\n    : {\n      : '',\n      : '',\n      : `20{{user}}\n\n\n1. \n2. \n3. \n4. \n\n`,\n    },\n  },\n\n  // ===============================================\n  // 2:  - \n  // ===============================================\n  {\n    : 2,\n    : {\n      : '',\n      : '',\n      : `\n\n\n1. \n2. \n3. \n4. \"\"\n5. \n6. \n\n`,\n    },\n    : {\n      : '',\n      : '',\n      : `\n\n\n1. \n2. \n3. \n4. \"...\"\n5. \"\"\"\"\n6. \n\n`,\n    },\n  },\n\n  // ===============================================\n  // 3:  - \n  // ===============================================\n  {\n    : 3,\n    : {\n      : '',\n      : '',\n      : `\n\n\n1. \n2. \n3. \n4. \n5. \n6. \n\n\"......\"`,\n    },\n    : {\n      : '',\n      : '',\n      : `{{user}}\n\n\n1. \n2. \"\"\n3. \n4. \n5. \"{{user}}\"\n6. \"\"\"\"\n\n\"\"`,\n    },\n  },\n\n  // ===============================================\n  // 4:  - \n  // ===============================================\n  {\n    : 4,\n    : {\n      : '',\n      : '',\n      : `\n\n\n1. \n2. {{user}}\n3. \n4. \"\"\n5. {{user}}\n6. \n\n`,\n    },\n    : {\n      : '',\n      : '',\n      : `\n\n\n1. \n2. \n3. \n4. \"{{user}}\"\n5. \n6. \n\n\"...\"`,\n    },\n  },\n\n  // ===============================================\n  // 5:  - \n  // ===============================================\n  {\n    : 5,\n    : {\n      : '',\n      : '',\n      : `\"\"\n\n\n1. \n2. \n3. {{user}}\n4. \n5. \n6. \n7. \"{{user}}\"\n\n\"\"\n`,\n    },\n    : {\n      : '',\n      : '',\n      : `\"\"\n\n\n1. \n2. \n3. {{user}}\n4. \n5. {{user}}\"{{user}}\"\n6. \n7. \n\n\n`,\n    },\n  },\n];\n\n// ============================================\n// \n// ============================================\n\n/**\n * \n */\nexport function getStageConfig(stage: number): StageConfig | undefined {\n  return STAGE_CONFIG.find(config => config. === stage);\n}\n\n/**\n * \n */\nexport function getStageByCorruption(corruption: number): number {\n  for (const config of STAGE_CONFIG) {\n    const [min, max] = config.;\n    if (corruption >= min && corruption <= max) {\n      return config.;\n    }\n  }\n  return 5; // \n}\n\n/**\n * \n */\nexport function getStageTitle(stage: number): StageTitle {\n  const config = getStageConfig(stage);\n  return config?. || '';\n}\n\n/**\n * \n */\nexport function getStageTimeModifier(stage: number): number {\n  const config = getStageConfig(stage);\n  return config?. || 1.0;\n}\n\n/**\n * \n */\nexport function getStageStory(stage: number): StageStoryConfig | undefined {\n  return STAGE_STORY_CONFIG.find(config => config. === stage);\n}\n\n/**\n * \n */\nexport function generateStageBreakthroughInjection(\n  character: '' | '',\n  newStage: number,\n): string {\n  const storyConfig = getStageStory(newStage);\n  if (!storyConfig) return '';\n\n  const story = character === '' ? storyConfig. : storyConfig.;\n\n  return `\n\n\n\n   ${character}  ${newStage}${getStageTitle(newStage)}\n\n\n\n\n${character}\n- \n- ${character}\n- //\n\n\n${story.}\n\n\n${story.}\n\n\n1. ${character}//\n2. ${character}\n3. \n4. ${character}\n5. ${getStageTitle(newStage)}\n\n\n- \n- ${character}\n- ${character}\n\n\n- {{user}}{{user}}\n- {{user}}\n- ${character}\n\n${character}\n\n`;\n}\n\n/**\n * Prefill\n */\nexport function generateStageBreakthroughPrefill(\n  character: '' | '',\n  newStage: number,\n): string {\n  return `${getStageTitle(newStage)}\n\n${character}...\n\n`;\n}\n","/**\n * \n * /\n */\n\nimport type { SchemaType } from '../../schema';\nimport { getStageByCorruption, getStageTitle } from '../../stageConfig';\n\n// \nconst HABIT_LIMIT = 16;\n\nfunction isThoughtExpired(thought: { : string }, currentTime: string): boolean {\n  const expirationTime = parseTimeStr(thought.);\n  const current = parseTimeStr(currentTime);\n  return current >= expirationTime;\n}\n\nfunction parseTimeStr(timeStr: string): Date {\n  const [datePart, timePart] = timeStr.split(' ');\n  const [year, month, day] = datePart.split('/').map(Number);\n  const [hour, minute] = timePart.split(':').map(Number);\n  return new Date(year, month - 1, day, hour, minute);\n}\n\nfunction calculateRewards(\n  difficulty: '' | '' | '',\n  currentSubinDependency: number,\n): {\n  : number;\n  : number;\n  : number;\n  : number;\n} {\n  const baseRewards = {\n    : difficulty === '' ? -3 : -2,\n    : difficulty === '' ? 4 : 3,\n    : difficulty === '' ? 6 : 5,\n  };\n\n  let suwenDecrease = -2;\n  if (currentSubinDependency >= 80) {\n    suwenDecrease = -5;\n  } else if (currentSubinDependency >= 60) {\n    suwenDecrease = -4;\n  } else if (currentSubinDependency >= 30) {\n    suwenDecrease = -3;\n  }\n\n  if (difficulty === '') {\n    suwenDecrease = Math.floor(suwenDecrease * 1.2);\n  }\n\n  return {\n    ...baseRewards,\n    : suwenDecrease,\n  };\n}\n\nfunction calculatePenalties(): {\n  : number;\n  : number;\n} {\n  return {\n    : 3,\n    : -2,\n  };\n}\n\nexport interface ThoughtCheckResult {\n  matureCount: number;\n  expiredCount: number;\n  stageChanges: Array<{ character: string; oldStage: number; newStage: number }>;\n}\n\n/**\n * /\n * @param data \n * @returns \n */\nexport function checkMatureThoughts(data: SchemaType): ThoughtCheckResult {\n  const formationTime = (data as any)._ || `${data..} ${data..}`;\n  console.info(`[] : ${formationTime}`);\n\n  let matureCount = 0;\n  let expiredCount = 0;\n  const stageChanges: Array<{ character: string; oldStage: number; newStage: number }> = [];\n\n  (['', ''] as const).forEach(characterKey => {\n    const character = data[characterKey];\n    if (!character) return;\n\n    const thoughts = character.;\n    const now = `${data..} ${data..}`;\n    const characterName = characterKey === '' ? '' : '';\n\n    console.info(`[] ${characterKey} : ${now}, : ${thoughts.length}`);\n\n    const matureThoughts: Array<{ thought: typeof thoughts[0]; index: number; difficulty: string }> = [];\n    const expiredThoughts: Array<{ thought: typeof thoughts[0]; index: number; difficulty: string }> = [];\n\n    thoughts.forEach((thought, index) => {\n      const expired = isThoughtExpired(thought, now);\n      // 0\n      //  > 0   >=  \n      const isMature = !thought. && thought. > 0 && thought. >= thought.;\n\n      console.info(\n        `[] ${characterKey} [${index}]: \"${thought.}\" ` +\n        `=${thought.}/${thought.} =${thought.} =${expired} =${isMature}`\n      );\n\n      if (expired) {\n        expiredThoughts.push({ thought, index, difficulty: thought. });\n      } else if (isMature) {\n        matureThoughts.push({ thought, index, difficulty: thought. });\n      }\n    });\n\n    // \n    if (matureThoughts.length > 0) {\n      console.info(`[] ${characterKey}  ${matureThoughts.length} !`);\n      matureCount += matureThoughts.length;\n\n      matureThoughts.forEach(m => {\n        const rewards = calculateRewards(\n          m.difficulty as '' | '' | '',\n          character.,\n        );\n\n        console.info(`[] ${characterKey} : \"${m.thought.}\"`);\n\n        // \n        const newHabit = {\n          : m.thought.,\n          : formationTime,\n        };\n        character..push(newHabit);\n\n        // \n        if (character..length > HABIT_LIMIT) {\n          const removedHabit = character..shift(); // \n          console.info(`[] ${characterKey} (${HABIT_LIMIT}): \"${removedHabit?.}\"`);\n        }\n\n        console.info(`[] ${characterKey} , : ${character..length}`);\n\n        // \n        const oldMoral = character.;\n        const oldSubin = character.;\n        const oldSuwen = character.;\n        const oldCorruption = character.;\n\n        character. += rewards.;\n        character. += rewards.;\n        character. += rewards.;\n        character. += rewards.;\n\n        console.info(\n          `[] ${characterKey} : ` +\n          `${oldMoral}${character.}, ` +\n          `${oldSubin}${character.}, ` +\n          `${oldSuwen}${character.}, ` +\n          `${oldCorruption}${character.}`\n        );\n\n        // 5\n        const oldStage = character.;\n        const corruption = character.;\n        const newStage = getStageByCorruption(corruption);\n\n        if (newStage > oldStage) {\n          character. = newStage;\n          character. = getStageTitle(newStage);\n          console.info(`[] ${characterKey} : ${oldStage}(${getStageTitle(oldStage)})  ${newStage}(${getStageTitle(newStage)})`);\n          stageChanges.push({ character: characterName, oldStage, newStage });\n        }\n      });\n    }\n\n    // \n    if (expiredThoughts.length > 0) {\n      expiredCount += expiredThoughts.length;\n      expiredThoughts.forEach(m => {\n        console.info(`[] ${characterKey} : \"${m.thought.}\"`);\n        if (m.difficulty === '') {\n          const penalties = calculatePenalties();\n          character. += penalties.;\n          character. += penalties.;\n          console.info(`[] ${characterKey} `);\n        }\n      });\n    }\n\n    // \n    const allProcessed = [...matureThoughts, ...expiredThoughts].sort((a, b) => b.index - a.index);\n    allProcessed.forEach(m => {\n      thoughts.splice(m.index, 1);\n    });\n\n    if (allProcessed.length > 0) {\n      console.info(`[] ${characterKey}  ${allProcessed.length} `);\n    }\n  });\n\n  console.info(`[] : =${matureCount}, =${expiredCount}`);\n\n  return { matureCount, expiredCount, stageChanges };\n}\n","/**\n * \n * \n *  AI \n */\n\nimport type { SchemaType } from '../../schema';\n\n/**\n * \n * 520\n */\nfunction getQinluImpression(suspicion: number): string {\n  const stage = Math.floor(suspicion / 5);\n\n  const impressions = [\n    '', // 0-4\n    '', // 5-9\n    '', // 10-14\n    '', // 15-19\n    '', // 20-24\n    '', // 25-29\n    '', // 30-34\n    '', // 35-39\n    '', // 40-44\n    '', // 45-49\n    '', // 50-54\n    '', // 55-59\n    '', // 60-64\n    '', // 65-69\n    '', // 70-74\n    '', // 75-79\n    '', // 80-84\n    '', // 85-89\n    '', // 90-94\n    '', // 95-100\n  ];\n\n  return impressions[Math.min(stage, 19)] || impressions[19];\n}\n\n/**\n * \n * 520\n */\nfunction getSumengImpression(suspicion: number): string {\n  const stage = Math.floor(suspicion / 5);\n\n  const impressions = [\n    '', // 0-4\n    '', // 5-9\n    '', // 10-14\n    '', // 15-19\n    '', // 20-24\n    '', // 25-29\n    '', // 30-34\n    '', // 35-39\n    '', // 40-44\n    '', // 45-49\n    '', // 50-54\n    '', // 55-59\n    '', // 60-64\n    '', // 65-69\n    '', // 70-74\n    '', // 75-79\n    '', // 80-84\n    '', // 85-89\n    '', // 90-94\n    '', // 95-100\n  ];\n\n  return impressions[Math.min(stage, 19)] || impressions[19];\n}\n\nexport interface ImpressionUpdateResult {\n  qinluChanged: boolean;\n  sumengChanged: boolean;\n  qinluOldImpression?: string;\n  qinluNewImpression?: string;\n  sumengOldImpression?: string;\n  sumengNewImpression?: string;\n}\n\n/**\n * \n *  AI \n * @param data \n * @returns \n */\nexport function updateSuwenImpressions(data: SchemaType): ImpressionUpdateResult {\n  const result: ImpressionUpdateResult = {\n    qinluChanged: false,\n    sumengChanged: false,\n  };\n\n  // \n  const qinluSuspicion = data..;\n  const sumengSuspicion = data..;\n\n  // \n  const newQinluImpression = getQinluImpression(qinluSuspicion);\n  const newSumengImpression = getSumengImpression(sumengSuspicion);\n\n  // \n  if (data... !== newQinluImpression) {\n    result.qinluOldImpression = data...;\n    result.qinluNewImpression = newQinluImpression;\n    data... = newQinluImpression;\n    result.qinluChanged = true;\n    console.info(`[] : \"${result.qinluOldImpression}\"  \"${newQinluImpression}\"`);\n  }\n\n  if (data... !== newSumengImpression) {\n    result.sumengOldImpression = data...;\n    result.sumengNewImpression = newSumengImpression;\n    data... = newSumengImpression;\n    result.sumengChanged = true;\n    console.info(`[] : \"${result.sumengOldImpression}\"  \"${newSumengImpression}\"`);\n  }\n\n  return result;\n}\n","/**\n * 5\n * \n */\n\nimport type { SchemaType } from '../../schema';\nimport {\n  getStageConfig,\n  getStageTitle,\n  getExposureIndex,\n  getMakeupIndex,\n  type ExposureLevel,\n  type MakeupLevel,\n} from '../../stageConfig';\n\n/**\n * \n * \n */\nlet lastQinStage = -1;\nlet lastSuStage = -1;\n\n/**\n * \n */\nexport function initStageTracking(qinStage: number, suStage: number): void {\n  if (lastQinStage === -1) lastQinStage = qinStage;\n  if (lastSuStage === -1) lastSuStage = suStage;\n}\n\n/**\n * 5\n *  AI \n */\nfunction checkAndFixAppearanceConstraints(\n  targetKey: '' | '',\n  stage: number,\n  data: SchemaType,\n): boolean {\n  const config = getStageConfig(stage);\n  if (!config) {\n    console.warn(`[]  ${stage} `);\n    return false;\n  }\n\n  const targetState = data[targetKey];\n  const characterName = targetKey === '' ? '' : '';\n  let updated = false;\n\n  // \n  const currentExposure = targetState.. as ExposureLevel;\n  const currentMakeup = targetState.. as MakeupLevel;\n\n  const currentExposureIndex = getExposureIndex(currentExposure);\n  const currentMakeupIndex = getMakeupIndex(currentMakeup);\n\n  const minExposureIndex = getExposureIndex(config..);\n  const minMakeupIndex = getMakeupIndex(config..);\n\n  // \n  if (currentExposureIndex < minExposureIndex) {\n    console.info(\n      `[] ${characterName} ${stage}(${config.}) : ` +\n        `${currentExposure} < ${config..}`,\n    );\n\n    // \n    targetState.. = config...;\n    targetState.. = config...;\n    targetState.. = config...;\n    targetState.. = config...;\n    updated = true;\n  }\n\n  // \n  if (currentMakeupIndex < minMakeupIndex) {\n    console.info(\n      `[] ${characterName} ${stage}(${config.}) : ` +\n        `${currentMakeup} < ${config..}`,\n    );\n\n    // \n    targetState.. = config...;\n    targetState.. = config...;\n    targetState.. = config...;\n    targetState.. = config...;\n    targetState.. = config...;\n    updated = true;\n  }\n\n  // \n  if (!config.. && targetState.. !== '') {\n    console.info(`[] ${characterName} ${stage}(${config.}) `);\n    targetState.. = '';\n    updated = true;\n  }\n\n  // \n  if (!config..) {\n    const bodyMod = targetState.;\n    if (\n      !_.isEmpty(bodyMod.) ||\n      bodyMod.. ||\n      bodyMod.. ||\n      bodyMod.. ||\n      bodyMod.. ||\n      bodyMod.. ||\n      bodyMod.. ||\n      bodyMod..length > 0\n    ) {\n      console.warn(`[] ${characterName} ${stage}(${config.}) `);\n      // \n    }\n  }\n\n  if (updated) {\n    console.info(\n      `[] ${characterName} ${stage}(${config.}) :\\n` +\n        `  : ${targetState..} (: ${config..})\\n` +\n        `  : ${targetState..} (: ${config..})\\n` +\n        `  : ${targetState.}`,\n    );\n  }\n\n  return updated;\n}\n\nexport interface AppearanceUpdateResult {\n  qinluUpdated: boolean;\n  sumengUpdated: boolean;\n  qinluStageChanged: boolean;\n  sumengStageChanged: boolean;\n}\n\n/**\n * 5\n * @param data \n * @returns \n */\nexport function checkAndUpdateAppearance(data: SchemaType): AppearanceUpdateResult {\n  const result: AppearanceUpdateResult = {\n    qinluUpdated: false,\n    sumengUpdated: false,\n    qinluStageChanged: false,\n    sumengStageChanged: false,\n  };\n\n  const tracking = data.;\n\n  // \n  const qinStage = data..;\n\n  //  lastQinStage\n  if (lastQinStage === -1) {\n    lastQinStage = qinStage;\n    console.info(`[] : ${qinStage}(${getStageTitle(qinStage)})`);\n  }\n\n  const qinIsNewStage = qinStage !== lastQinStage;\n\n  console.info(`[] : =${qinStage}, =${lastQinStage}, =${qinIsNewStage}`);\n\n  if (qinIsNewStage && qinStage >= 1 && qinStage <= 5) {\n    console.info(`[]  : ${lastQinStage}(${getStageTitle(lastQinStage)})  ${qinStage}(${getStageTitle(qinStage)})`);\n    result.qinluStageChanged = true;\n\n    // \n    tracking. = {\n      : true,\n      : qinStage,\n      : `: ${getStageTitle(lastQinStage)}  ${getStageTitle(qinStage)}`,\n    };\n    console.info(`[] :`, JSON.stringify(tracking.));\n\n    // ROLL\n    //  > 1 \n    if (qinStage > 1) {\n      const currentTime = `${data..} ${data..}`;\n      const currentFloor = getLastMessageId();\n      tracking. = tracking. || [];\n      tracking..push({\n        : '',\n        : '',\n        : currentFloor,\n        : currentTime,\n        AI: false,\n        : qinStage,\n      });\n      console.info(`[] : ${qinStage}, ${currentFloor}`);\n    }\n\n    lastQinStage = qinStage;\n\n    // \n    const qinUpdated = checkAndFixAppearanceConstraints('', qinStage, data);\n    if (qinUpdated) {\n      // \n      console.info(`[]  `);\n      tracking.. = false;\n      tracking.. = '';\n      result.qinluUpdated = true;\n    } else {\n      console.info(`[]  true`);\n    }\n  } else if (qinStage >= 1 && qinStage <= 5) {\n    // AI\n    console.info(`[] : ${tracking.?.}`);\n    if (tracking.?.) {\n      const qinUpdated = checkAndFixAppearanceConstraints('', qinStage, data);\n      if (qinUpdated) result.qinluUpdated = true;\n    }\n  }\n\n  // \n  const suStage = data..;\n\n  //  lastSuStage\n  if (lastSuStage === -1) {\n    lastSuStage = suStage;\n    console.info(`[] : ${suStage}(${getStageTitle(suStage)})`);\n  }\n\n  const suIsNewStage = suStage !== lastSuStage;\n\n  console.info(`[] : =${suStage}, =${lastSuStage}, =${suIsNewStage}`);\n\n  if (suIsNewStage && suStage >= 1 && suStage <= 5) {\n    console.info(`[]  : ${lastSuStage}(${getStageTitle(lastSuStage)})  ${suStage}(${getStageTitle(suStage)})`);\n    result.sumengStageChanged = true;\n\n    // \n    tracking. = {\n      : true,\n      : suStage,\n      : `: ${getStageTitle(lastSuStage)}  ${getStageTitle(suStage)}`,\n    };\n    console.info(`[] :`, JSON.stringify(tracking.));\n\n    // ROLL\n    //  > 1 \n    if (suStage > 1) {\n      const currentTime = `${data..} ${data..}`;\n      const currentFloor = getLastMessageId();\n      tracking. = tracking. || [];\n      tracking..push({\n        : '',\n        : '',\n        : currentFloor,\n        : currentTime,\n        AI: false,\n        : suStage,\n      });\n      console.info(`[] : ${suStage}, ${currentFloor}`);\n    }\n\n    lastSuStage = suStage;\n\n    // \n    const suUpdated = checkAndFixAppearanceConstraints('', suStage, data);\n    if (suUpdated) {\n      console.info(`[]  `);\n      tracking.. = false;\n      tracking.. = '';\n      result.sumengUpdated = true;\n    } else {\n      console.info(`[]  true`);\n    }\n  } else if (suStage >= 1 && suStage <= 5) {\n    console.info(`[] : ${tracking.?.}`);\n    if (tracking.?.) {\n      const suUpdated = checkAndFixAppearanceConstraints('', suStage, data);\n      if (suUpdated) result.sumengUpdated = true;\n    }\n  }\n\n  console.info(`[] :`, JSON.stringify(result));\n  return result;\n}\n","/**\n * \n *\n * \n * - \n * - \n * - \n *\n * \n * 1. \n * 2.  AI \n * 3.  + \n */\n\n/**\n * \n */\nexport type ThoughtCategory =\n  | '' // \n  | '' // \n  | '' // \n  | '' // \n  | '' // \n  | '' // \n  | '' // \n  | '' // /\n  | '' // \n  | ''; // \n\n/**\n * 34\n * 10\n */\nexport type DetailedThoughtType =\n  // \n  | '' | '' | '' | '' | '' | '' | ''\n  //  - \n  | '' | '' | ''\n  //  - \n  | '' | '' | ''\n  //  - \n  | '' | '' | '' | '' | ''\n  //  - \n  | '' | ''\n  //  - \n  | '' | ''\n  // BDSM\n  | '' | '' | '' | '' | '' | ''\n  //  - \n  | '' | '' | ''\n  //  - \n  | '' | '' | '' | '' | ''\n  // \n  | '' | '' | '' | '';\n\n/**\n * \n */\nexport interface DetailedTypeConfig {\n  /**  */\n  type: DetailedThoughtType;\n  /**  */\n  keywords: string[];\n  /**  */\n  parentCategory: ThoughtCategory;\n  /**  */\n  recommendedStage: { min: number; max: number };\n}\n\n/**\n * 34\n */\nexport const DETAILED_THOUGHT_TYPES: DetailedTypeConfig[] = [\n  // ============  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', 'H', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 1, max: 1 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 1, max: 2 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 4, max: 5 },\n  },\n\n  // ============  -  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 1, max: 1 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n\n  // ============  -  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 4 },\n  },\n\n  // ============  -  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '69', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['3P', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 4, max: 5 },\n  },\n\n  // ============  -  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n\n  // ============  -  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 4 },\n  },\n\n  // ============ BDSM ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 5 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', 'SP', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 4, max: 5 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 5 },\n  },\n\n  // ============  -  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 1, max: 2 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', 'cosplay', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 1, max: 2 },\n  },\n\n  // ============  -  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 4 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 4 },\n  },\n\n  // ============  ============\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 2, max: 3 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 3, max: 5 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 4, max: 5 },\n  },\n  {\n    type: '',\n    keywords: ['', '', '', '', '', '', '', ''],\n    parentCategory: '',\n    recommendedStage: { min: 4, max: 5 },\n  },\n];\n\n/**\n *  - 10\n * \n */\nexport const LOCAL_KEYWORDS: Record<ThoughtCategory, string[]> = (() => {\n  const result: Record<ThoughtCategory, string[]> = {\n    : ['', '', '', '', '', '', ''],\n    : ['', '', '', '', '', '', '', ''],\n    : ['', '', '', '', '', '', ''],\n    : ['', '', '', '', '', '', ''],\n    : ['', '', ''],\n    : ['', '', ''],\n    : ['', '', '', '', ''],\n    : ['', '', '', ''],\n    : [\n      '', '', '', '',\n      // \n      '', '', '', '', '', '',\n      '', '', '', '', '',\n      '', '', '', '',\n      // /\n      '', '', '', '', '', '', '',\n    ],\n    : ['', '', '', '', '', '', ''],\n  };\n\n  // \n  for (const config of DETAILED_THOUGHT_TYPES) {\n    const category = config.parentCategory;\n    for (const keyword of config.keywords) {\n      if (!result[category].includes(keyword)) {\n        result[category].push(keyword);\n      }\n    }\n  }\n\n  return result;\n})();\n\n/**\n *  - \n */\nexport interface StageRequirement {\n  /** 'all'  */\n  allowed: ThoughtCategory[] | 'all';\n  /**  */\n  extra?: Partial<\n    Record<\n      ThoughtCategory,\n      {\n        ?: number; //  >= \n        ?: number; //  <= \n      }\n    >\n  >;\n}\n\nexport const STAGE_REQUIREMENTS: Record<number, StageRequirement> = {\n  1: {\n    allowed: ['', ''],\n    // 1\n  },\n  2: {\n    allowed: ['', '', '', ''],\n    extra: {\n      : { : 30 },\n      : { : 40 },\n    },\n  },\n  3: {\n    allowed: ['', '', '', '', '', ''],\n    extra: {\n      : { : 50, : 70 },\n      : { : 55, : 60 },\n    },\n  },\n  4: {\n    allowed: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    extra: {\n      : { : 65, : 50 },\n      : { : 70, : 40 },\n    },\n  },\n  5: {\n    allowed: 'all', // \n    extra: {\n      : { : 80, : 30 },\n      : { : 85, : 20 },\n    },\n  },\n};\n\n/**\n * \n */\nexport interface LocalJudgeResult {\n  /** AI */\n  result: '' | 'AI';\n  /**  */\n  category?: ThoughtCategory;\n  /**  */\n  detailedType?: DetailedThoughtType;\n  /**  */\n  matchedKeyword?: string;\n  /**  */\n  recommendedStage?: { min: number; max: number };\n}\n\n/**\n * \n * @param content \n * @returns  null\n */\nexport function matchDetailedType(content: string): DetailedTypeConfig | null {\n  // \n  const sortedTypes = [...DETAILED_THOUGHT_TYPES].sort(\n    (a, b) => b.recommendedStage.min - a.recommendedStage.min\n  );\n\n  for (const config of sortedTypes) {\n    for (const keyword of config.keywords) {\n      if (content.includes(keyword)) {\n        return config;\n      }\n    }\n  }\n  return null;\n}\n\n/**\n *  - \n * \n *\n * @param content \n * @returns \n */\nexport function localJudgeCategory(content: string): LocalJudgeResult {\n  // \n  const detailedMatch = matchDetailedType(content);\n  if (detailedMatch) {\n    return {\n      result: '',\n      category: detailedMatch.parentCategory,\n      detailedType: detailedMatch.type,\n      matchedKeyword: detailedMatch.keywords.find(k => content.includes(k)),\n      recommendedStage: detailedMatch.recommendedStage,\n    };\n  }\n\n  // 10\n  const priorityOrder: ThoughtCategory[] = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  for (const category of priorityOrder) {\n    const keywords = LOCAL_KEYWORDS[category];\n    for (const keyword of keywords) {\n      if (content.includes(keyword)) {\n        return {\n          result: '',\n          category,\n          matchedKeyword: keyword,\n        };\n      }\n    }\n  }\n\n  // \n  return { result: 'AI' };\n}\n\n/**\n * \n */\nexport interface ThoughtJudgeResult {\n  /**  */\n  category: ThoughtCategory | null;\n  /**  */\n  allowed: boolean;\n  /**  */\n  hours: number;\n  /** hours >= 26 */\n  willExpire: boolean;\n  /**  */\n  reason?: string;\n  /**  */\n  matchMethod: '' | 'AI' | '';\n}\n\n/**\n * \n */\nexport const THOUGHT_DIFFICULTIES = ['', '', '', ''] as const;\nexport type ThoughtDifficulty = (typeof THOUGHT_DIFFICULTIES)[number];\n\n/**\n * \n */\nexport function getBaseHours(stage: number): number {\n  switch (stage) {\n    case 1:\n      return 4;\n    case 2:\n      return 3;\n    case 3:\n      return 3;\n    case 4:\n      return 2;\n    case 5:\n    default:\n      return 2;\n  }\n}\n\n/**\n * \n */\nexport function getDifficultyLabel(hours: number): ThoughtDifficulty {\n  if (hours <= 3) return '';\n  if (hours <= 4) return '';\n  return '';\n}\n\n/**\n * \n */\nexport interface CheatModeOptions {\n  /**  */\n  isSleepingPillActive?: boolean;\n  /**  */\n  isHospitalized?: boolean;\n}\n\n/**\n * \n *\n * @param category \n * @param stage  (1-5)\n * @param dependency \n * @param moral \n * @param cheatOptions /\n * @returns \n */\nexport function checkThoughtAllowed(\n  category: ThoughtCategory,\n  stage: number,\n  dependency: number,\n  moral: number,\n  cheatOptions: CheatModeOptions | boolean = false,\n): ThoughtJudgeResult {\n  // APIboolean\n  const options: CheatModeOptions = typeof cheatOptions === 'boolean'\n    ? { isSleepingPillActive: cheatOptions }\n    : cheatOptions;\n\n  const { isSleepingPillActive = false, isHospitalized = false } = options;\n\n  // \n  if (isHospitalized) {\n    const hours = 2; // \n    return {\n      category,\n      allowed: true,\n      hours,\n      willExpire: false,\n      matchMethod: '',\n    };\n  }\n\n  // +15\n  const effectiveStage = isSleepingPillActive ? Math.min(stage + 1, 5) : stage;\n\n  const stageConfig = STAGE_REQUIREMENTS[effectiveStage] || STAGE_REQUIREMENTS[5];\n\n  // \n  if (stageConfig.allowed !== 'all' && !stageConfig.allowed.includes(category)) {\n    return {\n      category,\n      allowed: false,\n      hours: 26,\n      willExpire: true,\n      reason: `${stage}${category}`,\n      matchMethod: '',\n    };\n  }\n\n  // 10\n  const extraReq = stageConfig.extra?.[category];\n  if (extraReq) {\n    const dependencyThreshold = isSleepingPillActive\n      ? Math.max(0, (extraReq. || 0) - 10)\n      : extraReq.;\n    const moralThreshold = isSleepingPillActive\n      ? Math.min(100, (extraReq. || 100) + 10)\n      : extraReq.;\n\n    if (dependencyThreshold !== undefined && dependency < dependencyThreshold) {\n      return {\n        category,\n        allowed: false,\n        hours: 26,\n        willExpire: true,\n        reason: `${category}${dependencyThreshold}${dependency}`,\n        matchMethod: '',\n      };\n    }\n    if (moralThreshold !== undefined && moral > moralThreshold) {\n      return {\n        category,\n        allowed: false,\n        hours: 26,\n        willExpire: true,\n        reason: `${category}${moralThreshold}${moral}`,\n        matchMethod: '',\n      };\n    }\n  }\n\n  // \n  const hours = getBaseHours(stage);\n\n  return {\n    category,\n    allowed: true,\n    hours,\n    willExpire: false,\n    matchMethod: '',\n  };\n}\n\n/**\n * \n *\n *  needAI: true AI \n *\n * @param content \n * @param stage  (1-5)\n * @param dependency \n * @param moral \n * @param cheatOptions /API\n * @returns  needAI  true  AI \n */\nexport function judgeThought(\n  content: string,\n  stage: number,\n  dependency: number,\n  moral: number,\n  cheatOptions: CheatModeOptions | boolean = false,\n): ThoughtJudgeResult & { needAI: boolean } {\n  // APIboolean\n  const options: CheatModeOptions = typeof cheatOptions === 'boolean'\n    ? { isSleepingPillActive: cheatOptions }\n    : cheatOptions;\n\n  // \n  const localResult = localJudgeCategory(content);\n\n  if (localResult.result === '' && localResult.category) {\n    // \n    const result = checkThoughtAllowed(localResult.category, stage, dependency, moral, options);\n    return { ...result, needAI: false };\n  }\n\n  //  AI\n  // 2\n  const hours = options.isHospitalized ? 2 : getBaseHours(stage);\n  return {\n    category: null,\n    allowed: true, //  AI \n    hours,\n    willExpire: false,\n    matchMethod: '',\n    needAI: true,\n  };\n}\n\n/**\n * AI \n *\n * @param aiCategory AI \n * @param stage  (1-5)\n * @param dependency \n * @param moral \n * @param cheatOptions /API\n * @returns \n */\nexport function judgeWithAICategory(\n  aiCategory: ThoughtCategory,\n  stage: number,\n  dependency: number,\n  moral: number,\n  cheatOptions: CheatModeOptions | boolean = false,\n): ThoughtJudgeResult {\n  const result = checkThoughtAllowed(aiCategory, stage, dependency, moral, cheatOptions);\n  return { ...result, matchMethod: 'AI' };\n}\n\n/**\n * AI \n */\nexport const AI_JUDGE_PROMPT = `\n\n\n- \n- \n- \n- \n- \n- \n- \n- /\n- \n- \n\n{content}\n\n`;\n\n/**\n *  AI \n */\nexport function getAIJudgePrompt(content: string): string {\n  return AI_JUDGE_PROMPT.replace('{content}', content);\n}\n\n/**\n *  AI \n */\nexport function parseAIResponse(response: string): ThoughtCategory | null {\n  const allCategories: ThoughtCategory[] = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  const trimmed = response.trim();\n\n  // \n  if (allCategories.includes(trimmed as ThoughtCategory)) {\n    return trimmed as ThoughtCategory;\n  }\n\n  // AI \n  for (const cat of allCategories) {\n    if (trimmed.includes(cat)) {\n      return cat;\n    }\n  }\n\n  return null;\n}\n","/**\n * \n *\n * \n * - +1\n * - /\n * - \n * - \n * - \n *   - \n *   - //ROLL\n *\n * \n */\n\nimport { Schema, type SchemaType } from '../../schema';\nimport { advanceTime, isSleepingPillEffective, isHospitalized } from './timeAdvance';\nimport { checkMatureThoughts } from './thoughtCheck';\nimport { updateSuwenImpressions } from './impression';\nimport { checkAndUpdateAppearance, initStageTracking } from './appearance';\nimport { cleanupThoughtImplantLogs, cleanupForcedEventLogs } from './logCleanup';\nimport {\n  type ThoughtCategory,\n  parseAIResponse,\n  checkThoughtAllowed,\n  getDifficultyLabel,\n  getBaseHours,\n} from '../../thoughtCategoryLib';\n\n/**\n *  AI \n * : :=\n *\n * @param aiText AI \n * @returns \n */\nfunction parseThoughtJudgments(aiText: string): Array<{\n  : '' | '';\n  : string;\n  : ThoughtCategory;\n}> {\n  const results: Array<{\n    : '' | '';\n    : string;\n    : ThoughtCategory;\n  }> = [];\n\n  // : :=\n  // \n  const regex = /(|):(.+?)=([^\\n\\r]+)/g;\n  let match;\n\n  while ((match = regex.exec(aiText)) !== null) {\n    const [, role, content, typeStr] = match;\n    const parsedType = parseAIResponse(typeStr.trim());\n\n    if (parsedType) {\n      results.push({\n        : role as '' | '',\n        : content.trim(),\n        : parsedType,\n      });\n      console.info(`[] : ${role}:${content.trim()}=${parsedType}`);\n    } else {\n      console.warn(`[] : ${typeStr.trim()}`);\n    }\n  }\n\n  return results;\n}\n\n\n/**\n *  AI \n *\n * @param data \n * @param aiText AI \n */\nfunction processThoughtJudgments(data: SchemaType, aiText: string): void {\n  const judgments = parseThoughtJudgments(aiText);\n\n  if (judgments.length === 0) {\n    return;\n  }\n\n  console.info(`[]  ${judgments.length} `);\n\n  // \n  const sleepingPillActive = isSleepingPillEffective(data);\n  if (sleepingPillActive) {\n    console.info('[] ');\n  }\n\n  // \n  const hospitalized = isHospitalized(data);\n  if (hospitalized) {\n    console.info('[] ');\n  }\n\n  for (const judgment of judgments) {\n    // \n    const characterState = judgment. === '' ? data. : data.;\n    const thoughts = characterState.;\n\n    // \n    const thoughtIndex = thoughts.findIndex(\n      t => t. && t. === judgment.,\n    );\n\n    if (thoughtIndex === -1) {\n      // \n      const fuzzyIndex = thoughts.findIndex(\n        t => t. && t..includes(judgment.),\n      );\n\n      if (fuzzyIndex === -1) {\n        console.warn(`[] : ${judgment.}:${judgment.}`);\n        continue;\n      }\n\n      // \n      updatePendingThought(characterState, fuzzyIndex, judgment., sleepingPillActive, hospitalized);\n    } else {\n      updatePendingThought(characterState, thoughtIndex, judgment., sleepingPillActive, hospitalized);\n    }\n  }\n}\n\n/**\n * \n * @param characterState \n * @param thoughtIndex \n * @param category \n * @param isSleepingPillActive \n * @param isHospitalizedActive \n */\nfunction updatePendingThought(\n  characterState: SchemaType[''],\n  thoughtIndex: number,\n  category: ThoughtCategory,\n  isSleepingPillActive: boolean = false,\n  isHospitalizedActive: boolean = false,\n): void {\n  const thought = characterState.[thoughtIndex];\n\n  // 2\n  if (isHospitalizedActive) {\n    thought. = 2;\n    thought. = '';\n    thought. = false;\n\n    console.info(\n      `[]  : \"${thought.}\" => , 2`,\n    );\n    return;\n  }\n\n  const stage = characterState.;\n  const dependency = characterState.;\n  const moral = characterState.;\n\n  //  thoughtCategoryLib \n  const result = checkThoughtAllowed(category, stage, dependency, moral, isSleepingPillActive);\n\n  if (result.allowed) {\n    // \n    thought. = result.hours;\n    thought. = getDifficultyLabel(result.hours);\n    thought. = false;\n\n    console.info(\n      `[]  : \"${thought.}\" => =${category}, =${thought.}, =${thought.}h`,\n    );\n  } else {\n    // 2624\n    thought. = 26;\n    thought. = '';\n    thought. = false;\n\n    console.info(\n      `[]  : \"${thought.}\" => ${result.reason}`,\n    );\n  }\n}\n\n/**\n * AI\n * \"\"\n * \n *\n * @param data \n */\nfunction handlePendingThoughtTimeout(data: SchemaType): void {\n  const currentTime = `${data..} ${data..}`;\n\n  // \n  const hospitalized = isHospitalized(data);\n\n  (['', ''] as const).forEach(characterKey => {\n    const characterState = data[characterKey];\n    if (!characterState) return;\n\n    const characterName = characterKey === '' ? '' : '';\n\n    characterState..forEach((thought, index) => {\n      if (!thought.) return;\n\n      // 2\n      //  + 2 < \n      try {\n        const [datePart, timePart] = thought..split(' ');\n        const [year, month, day] = datePart.split('/').map(Number);\n        const [hour, minute] = timePart.split(':').map(Number);\n        const implantTime = new Date(year, month - 1, day, hour, minute);\n\n        const [curDatePart, curTimePart] = currentTime.split(' ');\n        const [curYear, curMonth, curDay] = curDatePart.split('/').map(Number);\n        const [curHour, curMinute] = curTimePart.split(':').map(Number);\n        const curTime = new Date(curYear, curMonth - 1, curDay, curHour, curMinute);\n\n        // 27200000\n        const timeDiff = curTime.getTime() - implantTime.getTime();\n        if (timeDiff >= 2 * 60 * 60 * 1000) {\n          // 2\n          if (hospitalized) {\n            thought. = 2;\n            thought. = '';\n            thought. = false;\n\n            console.info(\n              `[]  : ${characterName} \"${thought.}\"` +\n              `2`,\n            );\n          } else {\n            // \"\"\n            const defaultCategory: ThoughtCategory = '';\n            const stage = characterState.;\n            const hours = getBaseHours(stage);\n\n            thought. = hours;\n            thought. = getDifficultyLabel(hours);\n            thought. = false;\n\n            console.info(\n              `[] ${characterName} \"${thought.}\"AI` +\n              `\"${defaultCategory}\"=${thought.}=${hours}h`,\n            );\n          }\n        }\n      } catch (err) {\n        console.warn(`[] :`, err);\n      }\n    });\n  });\n}\n\n$(async () => {\n  await waitGlobalInitialized('Mvu');\n\n  let isFirstMessageAfterInit = false;\n  //  \"message_id:swipe_id\" \n  //  ROLL swipe_id \n  const processedEvents = new Set<string>();\n\n  //  swipe_id\n  function getSwipeId(messageId: number): number {\n    try {\n      const chat = SillyTavern.chat;\n      if (chat && chat[messageId]) {\n        return chat[messageId].swipe_id ?? 0;\n      }\n    } catch (err) {\n      console.warn(`[]  swipe_id :`, err);\n    }\n    return 0;\n  }\n\n  // \n  eventOn(Mvu.events.VARIABLE_INITIALIZED, () => {\n    isFirstMessageAfterInit = true;\n  });\n\n  // \n  async function processGameLogic(message_id: number, eventType: string) {\n    try {\n      const swipeId = getSwipeId(message_id);\n      const messageKey = `${message_id}:${swipeId}`;\n      console.info(`[] processGameLogic : message_id=${message_id}, swipe_id=${swipeId}, eventType=${eventType}`);\n\n      //  MESSAGE_RECEIVED \n      if (eventType === 'MESSAGE_RECEIVED' && isFirstMessageAfterInit) {\n        isFirstMessageAfterInit = false;\n        console.info(`[] : ${message_id}`);\n        return;\n      }\n\n      // \n      // - MESSAGE_SWIPED  ROLL\n      // -  message_id:swipe_id \n      if (eventType === 'MESSAGE_SWIPED') {\n        // ROLL  message_id \n        const keysToRemove = Array.from(processedEvents).filter(key => key.startsWith(`${message_id}:`));\n        keysToRemove.forEach(key => processedEvents.delete(key));\n        console.info(`[] ROLL  ${keysToRemove.length} : ${keysToRemove.join(', ')}`);\n      } else {\n        //  ROLL \n        if (processedEvents.has(messageKey)) {\n          console.info(`[] : ${messageKey} (: ${eventType})`);\n          return;\n        }\n      }\n\n      processedEvents.add(messageKey);\n      console.info(`[]  ${messageKey} `);\n\n      //  100 \n      if (processedEvents.size > 100) {\n        const oldestKeys = Array.from(processedEvents).slice(0, processedEvents.size - 100);\n        oldestKeys.forEach(key => processedEvents.delete(key));\n      }\n\n      const actualLastId = getLastMessageId();\n      console.info(`[]  ${eventType}  ID: ${message_id}: ${actualLastId}`);\n\n      // \n      const targetMessageId = actualLastId;\n      if (targetMessageId !== message_id) {\n        console.warn(`[]  ID(${message_id})(${targetMessageId})`);\n      }\n\n      // \n      const currentVars = Mvu.getMvuData({ type: 'message', message_id: targetMessageId });\n      const statData = _.get(currentVars, 'stat_data');\n\n      if (!statData) {\n        console.warn('[] stat_data ');\n        return;\n      }\n\n      const data = Schema.parse(statData);\n\n      // \n      //  checkMatureThoughts checkAndUpdateAppearance \n      initStageTracking(data.., data..);\n      console.info(`[] : =${data..}, =${data..}`);\n\n      // \n      let userText = '';\n      let aiText = '';\n      try {\n        const lastMessages = getChatMessages(-1);\n        const prevMessages = getChatMessages(-2);\n        const lastMessage = lastMessages.length > 0 ? lastMessages[0] : null;\n        const userMessage = prevMessages.length > 0 ? prevMessages[0] : null;\n        userText = userMessage && userMessage.role === 'user' ? (userMessage.message ?? '') : '';\n        aiText = lastMessage && lastMessage.role === 'assistant' ? (lastMessage.message ?? '') : '';\n      } catch (msgErr) {\n        console.warn('[] :', msgErr);\n      }\n\n      // \n      const timeResult = advanceTime(data, userText, aiText);\n      if (!timeResult) {\n        console.error('[] ');\n        return;\n      }\n\n      //  AI \n      if (aiText) {\n        processThoughtJudgments(data, aiText);\n      }\n\n      // AI2\n      handlePendingThoughtTimeout(data);\n\n      checkMatureThoughts(data);\n      updateSuwenImpressions(data);\n      checkAndUpdateAppearance(data);\n      cleanupThoughtImplantLogs(data, targetMessageId);\n      cleanupForcedEventLogs(data, targetMessageId);\n\n      // \n      const validatedData = Schema.parse(data);\n      _.set(currentVars, 'stat_data', validatedData);\n      await Mvu.replaceMvuData(currentVars, { type: 'message', message_id: targetMessageId });\n\n      console.info(`[]  ${targetMessageId}: ${validatedData.?.} ${validatedData.?.}`);\n\n      // \n      const verifyVars = Mvu.getMvuData({ type: 'message', message_id: targetMessageId });\n      const verifyData = _.get(verifyVars, 'stat_data');\n\n      if (verifyData?.?. !== timeResult.newTime || verifyData?.?. !== timeResult.newDate) {\n        console.error('[] ');\n        console.error(`: ${timeResult.newDate} ${timeResult.newTime}`);\n        console.error(`: ${verifyData?.?.} ${verifyData?.?.}`);\n      } else {\n        console.info(`[]  ${eventType} : ${timeResult.newDate} ${timeResult.newTime}`);\n      }\n\n    } catch (err) {\n      console.error('[] :', err);\n    }\n  }\n\n  // \n  eventOn(tavern_events.MESSAGE_RECEIVED, (message_id) => {\n    const id = Number(message_id);\n    console.info(`[]  MESSAGE_RECEIVED message_id=${id}`);\n    setTimeout(() => {\n      processGameLogic(id, 'MESSAGE_RECEIVED');\n    }, 300);\n  });\n\n  // ROLL\n  eventOn(tavern_events.MESSAGE_SWIPED, (message_id) => {\n    const id = Number(message_id);\n    console.info(`[]  MESSAGE_SWIPED message_id=${id}`);\n    setTimeout(() => {\n      processGameLogic(id, 'MESSAGE_SWIPED');\n    }, 300);\n    // \n    setTimeout(() => {\n      console.info('[]  IFRAME_DATA_REFRESH  (MESSAGE_SWIPED)');\n      eventEmit('IFRAME_DATA_REFRESH', { reason: 'MESSAGE_SWIPED', message_id: id });\n    }, 500);\n  });\n\n  // \n  eventOn(tavern_events.MESSAGE_DELETED, (message_id) => {\n    const id = Number(message_id);\n    console.info(`[]  MESSAGE_DELETED message_id=${id}`);\n\n    // \n    // \n    const keysToRemove = Array.from(processedEvents).filter(key => {\n      const keyMessageId = parseInt(key.split(':')[0], 10);\n      return keyMessageId >= id;\n    });\n    if (keysToRemove.length > 0) {\n      keysToRemove.forEach(key => processedEvents.delete(key));\n      console.info(`[] MESSAGE_DELETED  ${keysToRemove.length} : ${keysToRemove.join(', ')}`);\n    }\n\n    // \n    setTimeout(() => {\n      console.info('[]  IFRAME_DATA_REFRESH  (MESSAGE_DELETED)');\n      eventEmit('IFRAME_DATA_REFRESH', { reason: 'MESSAGE_DELETED', message_id: id });\n    }, 300);\n  });\n\n  //  ROLL \n  eventOn(tavern_events.GENERATION_ENDED, (message_id) => {\n    console.info(`[]  GENERATION_ENDED  message_id=${message_id}`);\n    // GENERATION_ENDED  message_id  ID \n    //  getLastMessageId()  ID\n    setTimeout(() => {\n      try {\n        const actualMessageId = getLastMessageId();\n        console.info(`[] GENERATION_ENDED  message_id=${actualMessageId}`);\n        //  message_id:swipe_id ROLL  swipe_id \n        processGameLogic(actualMessageId, 'GENERATION_ENDED');\n      } catch (err) {\n        console.warn(`[] GENERATION_ENDED  ID:`, err);\n        processGameLogic(Number(message_id), 'GENERATION_ENDED');\n      }\n    }, 300);\n    //  iframe \n    //  MESSAGE_DELETED  iframe \n    setTimeout(() => {\n      try {\n        const actualMessageId = getLastMessageId();\n        console.info('[]  IFRAME_DATA_REFRESH  (GENERATION_ENDED)');\n        eventEmit('IFRAME_DATA_REFRESH', { reason: 'GENERATION_ENDED', message_id: actualMessageId });\n      } catch (err) {\n        console.warn('[] GENERATION_ENDED :', err);\n      }\n    }, 800);\n  });\n\n  console.info('[]  MESSAGE_RECEIVED, MESSAGE_SWIPED  GENERATION_ENDED ');\n});\n","/**\n * \n *\n * \n * 1. \n * 2. \n *\n * \n * 1. \n * 2. 3ROLL\n * 3.  < 0 \n *     = 0 0\n */\n\nimport type { SchemaType } from '../../schema';\n\nexport interface LogCleanupResult {\n  beforeCount: number;\n  afterCount: number;\n  cleanedCount: number;\n}\n\n/**\n * \n * @param data \n * @param currentFloor \n * @returns \n */\nexport function cleanupThoughtImplantLogs(data: SchemaType, currentFloor: number): LogCleanupResult {\n  const beforeCount = data...length;\n\n  console.info(`[] : ${currentFloor}, : ${beforeCount}`);\n\n  data.. = data...filter(log => {\n    // \n    if (!log.AI) {\n      console.info(`[] : ${log.} - ${log.}`);\n      return true;\n    }\n\n    //  < 0 \n    //  = 0 0\n    if (log. < 0) {\n      console.info(`[] (${log.}): ${log.}`);\n      return false;\n    }\n\n    // \n    const floorDiff = currentFloor - log.;\n    const shouldKeep = floorDiff <= 3;\n\n    if (shouldKeep) {\n      console.info(`[] (${floorDiff}): ${log.} - ${log.}`);\n    } else {\n      console.info(`[] (${floorDiff}): ${log.} - ${log.}`);\n    }\n\n    return shouldKeep;\n  });\n\n  const afterCount = data...length;\n  const cleanedCount = beforeCount - afterCount;\n\n  if (cleanedCount > 0) {\n    console.info(`[]   ${cleanedCount}  ${afterCount} `);\n  } else {\n    console.info(`[]  3`);\n  }\n\n  return { beforeCount, afterCount, cleanedCount };\n}\n\n/**\n * \n * @param data \n * @param currentFloor \n * @returns \n */\nexport function cleanupForcedEventLogs(data: SchemaType, currentFloor: number): LogCleanupResult {\n  if (!data..) {\n    data.. = [];\n    return { beforeCount: 0, afterCount: 0, cleanedCount: 0 };\n  }\n\n  const beforeCount = data...length;\n\n  console.info(`[] : ${currentFloor}, : ${beforeCount}`);\n\n  data.. = data...filter(log => {\n    // \n    if (!log.AI) {\n      console.info(`[] : ${log.} - ${log.} - ${log.}`);\n      return true;\n    }\n\n    //  < 0 \n    if (log. < 0) {\n      console.info(`[] (${log.}): ${log.}`);\n      return false;\n    }\n\n    // \n    const floorDiff = currentFloor - log.;\n    const shouldKeep = floorDiff <= 3;\n\n    if (shouldKeep) {\n      console.info(`[] (${floorDiff}): ${log.} - ${log.} - ${log.}`);\n    } else {\n      console.info(`[] (${floorDiff}): ${log.} - ${log.} - ${log.}`);\n    }\n\n    return shouldKeep;\n  });\n\n  const afterCount = data...length;\n  const cleanedCount = beforeCount - afterCount;\n\n  if (cleanedCount > 0) {\n    console.info(`[]   ${cleanedCount}  ${afterCount} `);\n  } else {\n    console.info(`[]  3`);\n  }\n\n  return { beforeCount, afterCount, cleanedCount };\n}\n"],"names":["z","StageTitle","enum","ThoughtDifficulty","SuwenStatus","TemporaryThought","object","string","describe","coerce","number","default","boolean","Habit","ClothingDetails","MakeupDetails","BodyModification","record","array","CharacterState","transform","v","_","clamp","thoughts","seen","Set","filter","thought","has","add","SuwenLocation","SuspicionFreeze","Impression","SleepingPillState","HospitalizationState","SuwenState","WorldState","AppearancePendingUpdate","SuwenInterruption","SuwenPatrol","ThoughtImplantLog","ForcedEventLog","optional","SystemTracking","Schema","TIME_JUMP_RULES","keywords","days","nextDay","targetHour","hours","SPACE_GROUPS","getSpaceGroup","location","group","locations","Object","entries","includes","isSameSpace","location1","location2","group1","group2","parseTime","timeStr","dateStr","year","month","day","split","map","Number","hour","minute","Date","SLEEPING_PILL_KEYWORDS","HOSPITALIZATION_KEYWORDS","isSleepingPillCooldownOver","lastUseTime","currentDate","currentTime","lastDatePart","lastTimePart","lastTime","getTime","PATROL_CONFIG","baseProbability","timeModifiers","morning","start","end","modifier","afternoon","evening","night","suspicionModifiers","min","max","cooldownHours","calculatePatrolProbability","suspicion","probability","getTimeModifier","range","getSuspicionModifier","Math","checkThoughtRelevance","thoughtContent","userMessage","aiMessage","segments","s","length","push","len","i","word","slice","test","extractKeywords","combinedText","toLowerCase","matchCount","exactMatch","keyword","isSleepingPillEffective","data","isHospitalized","advanceTime","userText","aiText","oldDate","oldTime","console","error","minutes","isNaN","jumpHours","userInput","currentHour","some","pattern","RegExp","info","rule","find","k","undefined","hoursUntilTarget","detectTimeJump","hoursToAdvance","isTimeJump","setHours","getHours","newHours","String","padStart","newTime","getMinutes","newDate","getFullYear","getMonth","getDate","newWeekDay","getDay","tracking","worldLocation","isInSonRoom","currentLocationFromWorld","pop","oldLocation","timeInMinutes","dayOfWeek","newStatus","newLocation","random","isMorningShift","patrolActive","updateSuwenSchedule","currentFloor","getLastMessageId","text","hospState","warn","startTime","endTime","setDate","endYear","endMonth","endDay","endHour","endMinute","freezeEndTime","activateHospitalization","endTimeStr","endDatePart","endTimePart","currentTimeObj","remainingMs","remainingDays","ceil","updateHospitalizationState","detectSleepingPill","pillState","lastTriggerFloor","activateSleepingPill","isSleepingPillActive","remainingHours","updateSleepingPillState","currentLocation","currentCharacter","suwenLocation","suwenStatus","isInDanger","suwenState","characterLocation","shouldIncreaseSuspicion","dangerTimeField","currentDangerTime","suspicionField","lastDecayDate","lastYear","lastMonth","lastDay","curYear","curMonth","curDay","lastDateObj","currentDateObj","daysPassed","floor","totalDecay","forEach","oldValue","freezeField","characterKey","character","oldProgress","newDateObj","extendedYear","extendedMonth","extendedDay","extendedHour","extendedMinute","progressGain","patrolEvent","lastPatrolTime","isPatrolCooldownOver","patrolProbability","parseInt","deadlineHours","deadlineTime","deadlineHH","deadlineMM","patrolCharacter","patrolLog","log","deadlineTimeObj","triggerTimeParts","interruptionEvent","interruptionCharacter","interruptionLog","freezeHours","freezeEndYear","freezeEndMonth","freezeEndDay","freezeEndHour","freezeEndMinute","freezeFieldName","characterName","freezeEndTimeStr","freezeDatePart","freezeTimePart","EXPOSURE_LEVELS","MAKEUP_LEVELS","getExposureIndex","level","indexOf","getMakeupIndex","STAGE_CONFIG","getStageConfig","stage","config","getStageTitle","parseTimeStr","datePart","timePart","checkMatureThoughts","formationTime","matureCount","expiredCount","stageChanges","now","matureThoughts","expiredThoughts","index","expired","expirationTime","isThoughtExpired","isMature","difficulty","m","rewards","currentSubinDependency","baseRewards","suwenDecrease","calculateRewards","newHabit","removedHabit","shift","oldMoral","oldSubin","oldSuwen","oldCorruption","oldStage","newStage","corruption","getStageByCorruption","penalties","allProcessed","sort","a","b","splice","updateSuwenImpressions","result","qinluChanged","sumengChanged","qinluSuspicion","sumengSuspicion","newQinluImpression","impressions","getQinluImpression","newSumengImpression","getSumengImpression","qinluOldImpression","qinluNewImpression","sumengOldImpression","sumengNewImpression","lastQinStage","lastSuStage","checkAndFixAppearanceConstraints","targetKey","targetState","updated","currentExposure","currentMakeup","currentExposureIndex","currentMakeupIndex","minExposureIndex","minMakeupIndex","bodyMod","isEmpty","DETAILED_THOUGHT_TYPES","type","parentCategory","recommendedStage","STAGE_REQUIREMENTS","category","allowed","extra","getBaseHours","getDifficultyLabel","checkThoughtAllowed","dependency","moral","cheatOptions","options","willExpire","matchMethod","effectiveStage","stageConfig","reason","extraReq","dependencyThreshold","moralThreshold","parseAIResponse","response","allCategories","trimmed","trim","cat","processThoughtJudgments","judgments","results","regex","match","exec","role","content","typeStr","parsedType","parseThoughtJudgments","sleepingPillActive","hospitalized","judgment","characterState","thoughtIndex","findIndex","t","fuzzyIndex","updatePendingThought","isHospitalizedActive","$","async","waitGlobalInitialized","isFirstMessageAfterInit","processedEvents","processGameLogic","message_id","eventType","swipeId","messageId","chat","SillyTavern","swipe_id","err","getSwipeId","messageKey","keysToRemove","Array","from","key","startsWith","delete","join","size","actualLastId","targetMessageId","currentVars","Mvu","getMvuData","statData","get","parse","qinStage","suStage","lastMessages","getChatMessages","prevMessages","lastMessage","message","msgErr","timeResult","implantTime","curDatePart","curTimePart","curHour","curMinute","defaultCategory","handlePendingThoughtTimeout","qinluUpdated","sumengUpdated","qinluStageChanged","sumengStageChanged","qinIsNewStage","JSON","stringify","suIsNewStage","checkAndUpdateAppearance","beforeCount","floorDiff","shouldKeep","afterCount","cleanedCount","cleanupThoughtImplantLogs","cleanupForcedEventLogs","validatedData","set","replaceMvuData","verifyVars","verifyData","eventOn","events","VARIABLE_INITIALIZED","tavern_events","MESSAGE_RECEIVED","id","setTimeout","MESSAGE_SWIPED","eventEmit","MESSAGE_DELETED","GENERATION_ENDED","actualMessageId"],"ignoreList":[],"sourceRoot":""}