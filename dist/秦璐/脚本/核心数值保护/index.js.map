{"version":3,"file":"index.js","mappings":"AA8BAA,EAAEC,gBACMC,sBAAsB,OAG5B,MAAMC,EAAmC,CACvC,QACA,QACA,SAIIC,EAA6B,CACjC,OACA,SACA,SACA,SACA,OACA,QAIIC,EAA2B,CAC/B,OACA,OACA,QAIIC,EAAqB,CAAC,OAAQ,QAIpC,SAASC,EAAwBC,GAE/B,QAAKA,EAAKC,SAAS,UACZJ,EAAyBK,KAAKC,GAASH,EAAKI,SAAS,IAAMD,GACpE,CAGA,SAASE,EAAsBL,GAC7B,OAAOL,EAAuBO,KAAKC,GAC1BH,IAASG,GAASH,EAAKI,SAAS,IAAMD,IAAUH,EAAKC,SAAS,IAAME,EAAQ,KAEvF,CAGA,SAASG,EAA0BN,GACjC,IAAK,MAAMO,KAAUT,EACnB,IAAK,MAAMK,KAASP,EAA4B,CAC9C,MAAMY,EAAW,GAAGD,KAAUJ,IAC9B,GAAIH,IAASQ,GAAYR,EAAKI,SAAS,IAAMI,IAAaR,EAAKC,SAAS,IAAMO,EAAW,KACvF,OAAO,CAEX,CAEF,OAAO,CACT,CAGAC,QAAQC,IAAIC,OAAOC,eAAgB,CAACC,EAAiBC,EAAiBC,KACpEC,QAAQC,KAAK,gBAAgBH,EAASI,cAEtC,IAAIC,EAAiB,EAErB,IAAK,IAAIC,EAAIN,EAASI,OAAS,EAAGE,GAAK,EAAGA,IAAK,CAC7C,MAAMC,EAAUP,EAASM,GACnBpB,EAAOqB,EAAQC,OAAO,GAE5B,GAAItB,EAAM,CAER,GAAIK,EAAsBL,GAAO,CAC/BgB,QAAQO,KAAK,oBAAoBF,EAAQG,SAASxB,MAClDc,EAASW,OAAOL,EAAG,GACnBD,IACA,QACF,CAGA,GAAIb,EAA0BN,GAAO,CACnCgB,QAAQO,KAAK,oBAAoBF,EAAQG,SAASxB,MAClDc,EAASW,OAAOL,EAAG,GACnBD,IACA,QACF,CAGIpB,EAAwBC,KAC1BgB,QAAQO,KAAK,oBAAoBF,EAAQG,SAASxB,MAClDc,EAASW,OAAOL,EAAG,GACnBD,IAEJ,CACF,CAEIA,EAAiB,GACnBH,QAAQO,KAAK,gBAAgBJ,YAAyBL,EAASI,gBAInEF,QAAQC,KAAK","sources":["src://tavern_helper_template/src/秦璐/脚本/核心数值保护/index.ts"],"sourcesContent":["/**\n * 核心数值保护脚本\n *\n * 保护以下数值不被 AI 直接修改：\n *\n * 世界状态（由脚本完全控制，AI不可修改）：\n * - 世界.时间\n * - 世界.日期\n * - 世界.星期\n *\n * 时间推进说明：\n * - 默认每回合自动推进1小时\n * - 当玩家输入包含时间跳跃关键词时（如\"第二天\"、\"几小时后\"等），\n *   脚本会自动检测并跳跃相应时间\n * - AI无需也无法修改时间相关变量\n *\n * 角色核心数值（仅能通过念头系统变化）：\n * - 道德底线\n * - 对主角依存度\n * - 对苏文依存度\n * - 潜意识侵蚀度\n * - 当前阶段\n * - 阶段标题\n *\n * 念头系统数值（由脚本自动计算）：\n * - 念头培育区.*.开发进度\n * - 念头培育区.*.需要时间\n * - 念头培育区.*.过期时间\n */\n\n$(async () => {\n  await waitGlobalInitialized('Mvu');\n\n  // 世界时间字段（始终保护，AI不可修改）\n  const WORLD_PROTECTED_FIELDS: string[] = [\n    '世界.时间',\n    '世界.日期',\n    '世界.星期',\n  ];\n\n  // 需要保护的角色字段（秦璐和苏梦都适用）\n  const CHARACTER_PROTECTED_FIELDS = [\n    '道德底线',\n    '对主角依存度',\n    '对苏文依存度',\n    '潜意识侵蚀度',\n    '当前阶段',\n    '阶段标题',\n  ];\n\n  // 念头系统保护字段（这些由脚本自动计算，AI不应修改）\n  const THOUGHT_PROTECTED_FIELDS = [\n    '开发进度',\n    '需要时间',\n    '过期时间',\n  ];\n\n  // 角色前缀\n  const CHARACTER_PREFIXES = ['秦璐状态', '苏梦状态'];\n\n  // 检查路径是否匹配念头系统保护字段\n  // 念头培育区是数组，路径格式如：秦璐状态.念头培育区.0.开发进度\n  function isThoughtFieldProtected(path: string): boolean {\n    // 检查是否包含 念头培育区 且以保护字段结尾\n    if (!path.includes('念头培育区')) return false;\n    return THOUGHT_PROTECTED_FIELDS.some(field => path.endsWith('.' + field));\n  }\n\n  // 检查路径是否匹配世界保护字段\n  function isWorldProtectedField(path: string): boolean {\n    return WORLD_PROTECTED_FIELDS.some(field => {\n      return path === field || path.endsWith('.' + field) || path.includes('.' + field + '.');\n    });\n  }\n\n  // 检查路径是否匹配角色保护字段\n  function isCharacterProtectedField(path: string): boolean {\n    for (const prefix of CHARACTER_PREFIXES) {\n      for (const field of CHARACTER_PROTECTED_FIELDS) {\n        const fullPath = `${prefix}.${field}`;\n        if (path === fullPath || path.endsWith('.' + fullPath) || path.includes('.' + fullPath + '.')) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  // 监听命令解析事件\n  eventOn(Mvu.events.COMMAND_PARSED, (_variables: any, commands: any[], _message_content: string) => {\n    console.info(`[核心数值保护] 解析到 ${commands.length} 个命令`);\n\n    let interceptCount = 0;\n    // 从后往前遍历，便于删除\n    for (let i = commands.length - 1; i >= 0; i--) {\n      const command = commands[i];\n      const path = command.args?.[0];\n\n      if (path) {\n        // 检查世界保护字段（始终拦截）\n        if (isWorldProtectedField(path)) {\n          console.warn(`[核心数值保护] 拦截世界字段: ${command.type} \"${path}\"`);\n          commands.splice(i, 1);\n          interceptCount++;\n          continue;\n        }\n\n        // 检查角色保护字段（始终拦截）\n        if (isCharacterProtectedField(path)) {\n          console.warn(`[核心数值保护] 拦截角色字段: ${command.type} \"${path}\"`);\n          commands.splice(i, 1);\n          interceptCount++;\n          continue;\n        }\n\n        // 检查念头系统保护字段（始终拦截）\n        if (isThoughtFieldProtected(path)) {\n          console.warn(`[核心数值保护] 拦截念头字段: ${command.type} \"${path}\"`);\n          commands.splice(i, 1);\n          interceptCount++;\n        }\n      }\n    }\n\n    if (interceptCount > 0) {\n      console.warn(`[核心数值保护] 共拦截 ${interceptCount} 个命令，剩余 ${commands.length} 个命令`);\n    }\n  });\n\n  console.info('[核心数值保护] 脚本加载完成');\n});\n"],"names":["$","async","waitGlobalInitialized","WORLD_PROTECTED_FIELDS","CHARACTER_PROTECTED_FIELDS","THOUGHT_PROTECTED_FIELDS","CHARACTER_PREFIXES","isThoughtFieldProtected","path","includes","some","field","endsWith","isWorldProtectedField","isCharacterProtectedField","prefix","fullPath","eventOn","Mvu","events","COMMAND_PARSED","_variables","commands","_message_content","console","info","length","interceptCount","i","command","args","warn","type","splice"],"ignoreList":[],"sourceRoot":""}